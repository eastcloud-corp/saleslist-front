"use strict";exports.id=852,exports.ids=[852],exports.modules={4029:(e,t,a)=>{a.d(t,{B:()=>d,Y:()=>l});var r=a(3210),s=a(9266),n=a(7163),i=a(8848),o=a(6234);function l(e={}){let t=(0,o.h)("projects:useProjects"),{page:a=1,limit:d=20,filters:c={}}=e,[u,h]=(0,r.useState)([]),[p,m]=(0,r.useState)({page:1,limit:20,total:0,total_pages:0}),[g,f]=(0,r.useState)(!0),[y,v]=(0,r.useState)(null),x=(0,r.useCallback)(async()=>{if(!i.authService.isAuthenticated()){f(!1);return}f(!0),v(null);try{let e=new URLSearchParams({page:a.toString(),limit:d.toString(),management_mode:"true"});Object.entries(c).forEach(([t,a])=>{null!=a&&("string"!=typeof a||""!==a.trim())&&e.append(t,String(a))}),t.debug("fetchProjects: request",{params:e.toString()});let r=await s.uE.get(`/projects?${e.toString()}`);t.debug("fetchProjects: response",{count:r.count}),h(r.results||[]);let n=Math.ceil((r.count||0)/d);m({page:a,limit:d,total:r.count||0,total_pages:n})}catch(e){t.error("fetchProjects: error",{message:e instanceof Error?e.message:String(e)}),v(e instanceof Error?e.message:"エラーが発生しました"),h([]),m({page:1,limit:d,total:0,total_pages:0})}finally{f(!1)}},[c,d,a]);return{projects:u,pagination:p,isLoading:g,error:y,createProject:async e=>{try{return await s.uE.post(n.i3.ENDPOINTS.PROJECTS,e),await x(),t.info("createProject: success"),!0}catch(e){throw t.error("createProject: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("An error occurred")}},refetch:x}}function d(e){let t=(0,o.h)("projects:useProject",{projectId:e}),[a,l]=(0,r.useState)(null),[d,c]=(0,r.useState)(!0),[u,h]=(0,r.useState)(null),[p,m]=(0,r.useState)([]),[g,f]=(0,r.useState)(!1),y=async()=>{if(!i.authService.isAuthenticated()){c(!1);return}c(!0),h(null);try{t.debug("fetchProject: request");let a=await s.uE.get(`/projects/${e}/?management_mode=true`);t.debug("fetchProject: response",{updated_at:a.updated_at}),l(a)}catch(e){t.error("fetchProject: error",{message:e instanceof Error?e.message:String(e)}),h(e instanceof Error?e.message:"エラーが発生しました"),l(null)}finally{c(!1)}};return{project:a,isLoading:d,error:u,updateProject:async a=>{try{return await s.uE.put(`${n.i3.ENDPOINTS.PROJECTS}${e}/`,a),await y(),t.info("updateProject: success",{fields:Object.keys(a)}),!0}catch(e){throw t.error("updateProject: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},updateCompanyStatus:async(a,r)=>{try{return await s.uE.patch(`${n.i3.ENDPOINTS.PROJECTS}${e}/companies/${a}/`,r),await y(),t.info("updateCompanyStatus: success",{companyId:a,status:r.status}),!0}catch(e){throw t.error("updateCompanyStatus: error",{companyId:a,message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},addCompanies:async a=>{try{return await s.uE.post(`${n.i3.ENDPOINTS.PROJECTS}${e}/add-companies/`,{company_ids:a}),await y(),t.info("addCompanies: success",{companyIds:a}),!0}catch(e){throw t.error("addCompanies: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},removeCompany:async a=>{try{return await s.uE.delete(`${n.i3.ENDPOINTS.PROJECTS}${e}/companies/${a}/`),await y(),t.info("removeCompany: success",{companyId:a}),!0}catch(e){throw t.error("removeCompany: error",{companyId:a,message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},availableCompanies:p,isLoadingAvailableCompanies:g,refetch:y}}},4604:(e,t,a)=>{a.d(t,{o:()=>s});var r=a(3210);function s(){let[e,t]=(0,r.useState)([]),[a,s]=(0,r.useState)([]),[n,i]=(0,r.useState)([]),[o,l]=(0,r.useState)(!0),[d,c]=(0,r.useState)(null);return{industries:e,statuses:a,prefectures:n,loading:o,error:d}}a(9266),a(7163)},5616:(e,t,a)=>{a.d(t,{T:()=>n});var r=a(687);a(3210);var s=a(6241);function n({className:e,...t}){return(0,r.jsx)("textarea",{"data-slot":"textarea",className:(0,s.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...t})}},6234:(e,t,a)=>{a.d(t,{h:()=>i});let r={error:0,warn:1,info:2,debug:3},s=(()=>{let e=(("undefined"!=typeof process?process.env.NEXT_PUBLIC_LOG_LEVEL:void 0)??"info").toLowerCase();return["error","warn","info","debug"].includes(e)?e:"info"})();function n(e){return r[e]<=r[s]}function i(e,t={}){return{error(e,t){if(!n("error"))return},warn(e,t){if(!n("warn"))return},info(e,t){if(!n("info"))return},debug(e,t){if(!n("debug"))return}}}i("app")},6752:(e,t,a)=>{a.d(t,{A0:()=>i,BF:()=>o,Hj:()=>l,XI:()=>n,nA:()=>c,nd:()=>d});var r=a(687);a(3210);var s=a(6241);function n({className:e,...t}){return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,s.cn)("w-full caption-bottom text-sm",e),...t})})}function i({className:e,...t}){return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,s.cn)("[&_tr]:border-b",e),...t})}function o({className:e,...t}){return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,s.cn)("[&_tr:last-child]:border-0",e),...t})}function l({className:e,...t}){return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,s.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function d({className:e,...t}){return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,s.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function c({className:e,...t}){return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,s.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}},8508:(e,t,a)=>{a.d(t,{B:()=>c,Kz:()=>d,aq:()=>o,tH:()=>l});var r=a(3210),s=a(7163);let n=(...e)=>{},i=(...e)=>{};function o(e={}){let{page:t=1,limit:a=50,filters:l={}}=e,[d,c]=(0,r.useState)([]),[u,h]=(0,r.useState)(!0),[p,m]=(0,r.useState)(null),[g,f]=(0,r.useState)({page:1,limit:50,total:0,total_pages:1}),y=async()=>{try{h(!0),m(null);let e=new URLSearchParams({page:t.toString(),page_size:a.toString(),...Object.fromEntries(Object.entries(l).filter(([e,t])=>void 0!==t&&""!==t&&("industry"!==e||"all"!==t)))}),r=await s.uE.get(`/clients?${e}`);n("一覧レスポンス",r);let o=await r.json();n("APIレスポンス構造",o),o&&"object"==typeof o?Array.isArray(o.results)?(c(o.results),f({page:t,limit:a,total:o.count||0,total_pages:Math.ceil((o.count||0)/a)})):Array.isArray(o)?(c(o),f({page:t,limit:a,total:o.length,total_pages:Math.ceil(o.length/a)})):(i("Unexpected response format",o),m("予期しないAPIレスポンス形式")):m("APIからデータを取得できませんでした")}catch(e){m(e instanceof Error?e.message:"クライアント一覧の取得に失敗しました")}finally{h(!1)}};(0,r.useEffect)(()=>{y()},[t,a,JSON.stringify(l)]);let v=async e=>{try{n("クライアント作成",e);let t=await s.uE.post("/clients/",e);if(t.ok){let e=await t.json();return n("クライアント作成成功",e),await y(),e}throw Error("クライアントの作成に失敗しました")}catch(e){throw e}},x=async(e,t)=>{try{n("クライアント更新",{id:e,clientData:t});let a=await s.uE.put(`/clients/${e}/`,t);if(a.ok){let e=await a.json();return n("クライアント更新成功",e),await y(),e}throw Error("クライアントの更新に失敗しました")}catch(e){throw e}};return{clients:d,loading:u,error:p,pagination:g,refetch:y,createClient:v,updateClient:x}}function l(e){let[t,a]=(0,r.useState)(null),[i,o]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null);return{client:t,loading:i,error:l,refetch:async()=>{try{o(!0),d(null),n("クライアント詳細を取得",{id:e});let t=await s.uE.get(`/clients/${e}`);if(t.ok){let e=await t.json();n("クライアント詳細取得成功",e),e&&e.id?a(e):d("クライアント詳細データが見つかりません")}else throw Error("クライアント詳細の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"クライアント詳細の取得に失敗しました")}finally{o(!1)}}}}function d(e){let[t,a]=(0,r.useState)(null),[i,o]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null);return{stats:t,loading:i,error:l,refetch:async()=>{try{o(!0),d(null),n("クライアント統計情報を取得",{id:e});let t=await s.uE.get(`/clients/${e}/stats`);if(t.ok){let e=await t.json();n("クライアント統計情報取得成功",e),e?a(e):d("統計情報が見つかりません")}else throw Error("統計情報の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"統計情報の取得に失敗しました")}finally{o(!1)}}}}function c(e){let[t,a]=(0,r.useState)([]),[i,o]=(0,r.useState)(!0),[l,d]=(0,r.useState)(null);return{projects:t,loading:i,error:l,refetch:async()=>{try{o(!0),d(null),n("クライアント関連案件を取得",{id:e});let t=await s.uE.get(`/clients/${e}/projects`);if(t.ok){let e=await t.json();n("クライアント関連案件取得成功",e),e&&Array.isArray(e.results)?a(e.results):e&&Array.isArray(e)?a(e):d("関連案件データが見つかりません")}else throw Error("関連案件の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"関連案件の取得に失敗しました")}finally{o(!1)}}}}},8696:(e,t,a)=>{a.d(t,{b:()=>l});var r=a(3210);a(1215);var s=a(1329),n=a(687),i=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let a=(0,s.TL)(`Primitive.${t}`),i=r.forwardRef((e,r)=>{let{asChild:s,...i}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,n.jsx)(s?a:t,{...i,ref:r})});return i.displayName=`Primitive.${t}`,{...e,[t]:i}},{}),o=r.forwardRef((e,t)=>(0,n.jsx)(i.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));o.displayName="Label";var l=o},8819:(e,t,a)=>{a.d(t,{A:()=>r});let r=(0,a(2688).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},9266:(e,t,a)=>{a.d(t,{uE:()=>n});class r extends Error{constructor(e,t,a){super(e),this.status=t,this.response=a,this.name="ApiError"}}class s{getAuthHeaders(){return{}}async refreshToken(){return Promise.resolve()}clearTokens(){}async handleResponse(e,t,a){return this.processResponse(e)}async processResponse(e){if(!e.ok){await this.handleUnauthorized(e.status);let t=`HTTP ${e.status}: ${e.statusText}`;try{let a=await e.json();t=a.message||a.error||t}catch{}throw new r(t,e.status,e)}let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():e.text()}async handleUnauthorized(e){}buildUrl(e){let t=(process.env.NEXT_INTERNAL_API_URL||process.env.NEXT_PUBLIC_API_URL)+"/api/v1";return`${t}${e}`}async makeRequest(e,t){return fetch(this.buildUrl(e),{...t,headers:{...t.headers,...this.getAuthHeaders()}})}async get(e,t){let a={method:"GET",headers:{"Content-Type":"application/json",...t?.headers},...t},r=await this.makeRequest(e,a);return this.handleResponse(r,e,a)}async post(e,t,a){let r={method:"POST",headers:{"Content-Type":"application/json",...a?.headers},body:t?JSON.stringify(t):void 0,...a},s=await this.makeRequest(e,r);return this.handleResponse(s,e,r)}async put(e,t,a){let r={method:"PUT",headers:{"Content-Type":"application/json",...a?.headers},body:t?JSON.stringify(t):void 0,...a},s=await this.makeRequest(e,r);return this.handleResponse(s,e,r)}async patch(e,t,a){let r={method:"PATCH",headers:{"Content-Type":"application/json",...a?.headers},body:t?JSON.stringify(t):void 0,...a},s=await this.makeRequest(e,r);return this.handleResponse(s,e,r)}async delete(e,t){let a={method:"DELETE",headers:{"Content-Type":"application/json",...t?.headers},...t},r=await this.makeRequest(e,a);return this.handleResponse(r,e,a)}async uploadFile(e,t,a){let r=new FormData;r.append("file",t),a&&Object.entries(a).forEach(([e,t])=>{r.append(e,String(t))});let s={method:"POST",body:r},n=await this.makeRequest(e,s);return this.handleResponse(n,e,s)}async downloadFile(e){let t=await this.makeRequest(e,{method:"GET"});if(!t.ok)throw new r(`Failed to download file: ${t.statusText}`,t.status,t);return t.blob()}constructor(){this.retryCount=0,this.maxRetries=0,this.isRefreshingToken=!1,this.refreshPromise=null,this.isHandlingUnauthorized=!1}}let n=new s},9616:(e,t,a)=>{a.d(t,{o:()=>g});var r=a(687),s=a(3210),n=a(4934),i=a(8988),o=a(9390),l=a(5616),d=a(3974),c=a(5192),u=a(8508),h=a(8819),p=a(1860),m=a(4604);function g({project:e,onSave:t,onCancel:a,isLoading:g=!1}){let{statuses:f}=(0,m.o)(),[y,v]=(0,s.useState)({name:e?.name||"",client_id:e?.client_id||"",description:e?.description||"",manager:e?.manager||"",target_industry:e?.target_industry||"",target_company_size:e?.target_company_size||"",status:e?.status||"active",start_date:e?.start_date||"",end_date:e?.end_date||""}),[x,b]=(0,s.useState)({}),{clients:j,loading:w}=(0,u.aq)({limit:100}),_=()=>{let e={};return y.name.trim()||(e.name="案件名は必須です"),y.client_id||(e.client_id="クライアントは必須です"),y.start_date||(e.start_date="契約開始日は必須です"),y.end_date&&y.start_date&&new Date(y.end_date)<new Date(y.start_date)&&(e.end_date="契約終了日は契約開始日より後である必要があります"),b(e),0===Object.keys(e).length},S=async e=>{if(e.preventDefault(),_())try{await t(y)}catch(e){}},E=(e,t)=>{v(a=>({...a,[e]:t})),x[e]&&b(t=>({...t,[e]:""}))};return(0,r.jsxs)(c.Zp,{children:[(0,r.jsx)(c.aR,{children:(0,r.jsx)(c.ZB,{children:e?"案件を編集":"新しい案件を作成"})}),(0,r.jsx)(c.Wu,{children:(0,r.jsxs)("form",{onSubmit:S,className:"space-y-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(o.J,{htmlFor:"name",children:"案件名 *"}),(0,r.jsx)(i.p,{id:"name",value:y.name,onChange:e=>E("name",e.target.value),disabled:g,className:x.name?"border-destructive":""}),x.name&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:x.name})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(o.J,{htmlFor:"client_id",children:"クライアント *"}),(0,r.jsxs)(d.l6,{value:y.client_id?.toString(),onValueChange:e=>E("client_id",e),children:[(0,r.jsx)(d.bq,{className:x.client_id?"border-destructive":"",children:(0,r.jsx)(d.yv,{placeholder:w?"読み込み中...":"クライアントを選択"})}),(0,r.jsx)(d.gC,{children:!w&&j.map(e=>(0,r.jsx)(d.eb,{value:e.id.toString(),children:e.name},e.id))})]}),x.client_id&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:x.client_id})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"manager",children:"担当者"}),(0,r.jsx)(i.p,{id:"manager",value:y.manager,onChange:e=>E("manager",e.target.value),disabled:g,placeholder:"バジェット側担当者名"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"status",children:"ステータス"}),(0,r.jsxs)(d.l6,{value:y.status,onValueChange:e=>E("status",e),children:[(0,r.jsx)(d.bq,{children:(0,r.jsx)(d.yv,{placeholder:"ステータスを選択"})}),(0,r.jsx)(d.gC,{children:f.filter(e=>"project"===e.category).map(e=>(0,r.jsx)(d.eb,{value:e.name,children:e.name},e.name))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"target_industry",children:"ターゲット業界"}),(0,r.jsx)(i.p,{id:"target_industry",value:y.target_industry,onChange:e=>E("target_industry",e.target.value),disabled:g,placeholder:"IT・ソフトウェア"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"target_company_size",children:"ターゲット企業規模"}),(0,r.jsx)(i.p,{id:"target_company_size",value:y.target_company_size,onChange:e=>E("target_company_size",e.target.value),disabled:g,placeholder:"50-500名"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"start_date",children:"契約開始日 *"}),(0,r.jsx)(i.p,{id:"start_date",type:"date",value:y.start_date,onChange:e=>E("start_date",e.target.value),disabled:g,className:x.start_date?"border-destructive":""}),x.start_date&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:x.start_date})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(o.J,{htmlFor:"end_date",children:"契約終了日"}),(0,r.jsx)(i.p,{id:"end_date",type:"date",value:y.end_date,onChange:e=>E("end_date",e.target.value),disabled:g,className:x.end_date?"border-destructive":""}),x.end_date&&(0,r.jsx)("p",{className:"text-sm text-destructive mt-1",children:x.end_date})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)(o.J,{htmlFor:"description",children:"説明"}),(0,r.jsx)(l.T,{id:"description",rows:4,value:y.description,onChange:e=>E("description",e.target.value),disabled:g})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 pt-4 border-t",children:[(0,r.jsxs)(n.$,{type:"submit",disabled:g,children:[(0,r.jsx)(h.A,{className:"h-4 w-4 mr-2"}),g?"保存中...":e?"変更を保存":"案件を作成"]}),(0,r.jsxs)(n.$,{type:"button",variant:"outline",onClick:a,disabled:g,children:[(0,r.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"キャンセル"]})]})]})})]})}},9821:(e,t,a)=>{a.d(t,{E:()=>l});var r=a(687);a(3210);var s=a(1329),n=a(4224),i=a(6241);let o=(0,n.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:t,asChild:a=!1,...n}){let l=a?s.DX:"span";return(0,r.jsx)(l,{"data-slot":"badge",className:(0,i.cn)(o({variant:t}),e),...n})}}};