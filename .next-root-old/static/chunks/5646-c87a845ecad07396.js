"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5646],{1056:(e,t,r)=>{r.d(t,{authService:()=>n});var s=r(9509);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}async login(e){try{let t=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("ログインに失敗しました");let r=await t.json();if(r.access_token&&r.refresh_token)return this.setTokens(r.access_token,r.refresh_token),r;throw Error("ログインに失敗しました - 無効なレスポンス形式")}catch(e){throw e}}async logout(){try{let e=this.getRefreshToken();await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/logout/"),{method:"POST",headers:{"Content-Type":"application/json",...this.getAuthHeaders()},body:JSON.stringify({refresh_token:e})})}catch(e){}finally{this.clearTokens()}}async refreshAccessToken(){if(!this.refreshToken)throw Error("リフレッシュトークンが利用できません");let e=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshToken})});if(!e.ok)throw this.clearTokens(),Error("トークンの更新に失敗しました");let t=await e.json();if(t.access_token)return this.accessToken=t.access_token,this.accessToken&&localStorage.setItem("access_token",this.accessToken),this.accessToken||"";throw Error("トークンの更新に失敗しました")}setTokens(e,t){this.accessToken=e,this.refreshToken=t,localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t)}clearTokens(){this.accessToken=null,this.refreshToken=null,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}getAuthHeaders(){return this.accessToken?{Authorization:"Bearer ".concat(this.accessToken)}:{}}isAuthenticated(){return!!this.accessToken}getAccessToken(){return this.accessToken}getRefreshToken(){return this.refreshToken}constructor(){this.accessToken=null,this.refreshToken=null,this.accessToken=localStorage.getItem("access_token"),this.refreshToken=localStorage.getItem("refresh_token")}}let n=a.getInstance()},1863:(e,t,r)=>{r.d(t,{A:()=>l,AuthProvider:()=>c});var s=r(5155),a=r(2115),n=r(1056),i=r(9509);let o=(0,a.createContext)(void 0);function c(e){let{children:t}=e,[r,c]=(0,a.useState)(null),[l,d]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=()=>{window.location.pathname.startsWith("/login")||(window.location.href="/login")};(async()=>{try{if(!n.authService.isAuthenticated()){c(null),e();return}let t=i.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("NEXT_PUBLIC_API_URL is not configured");let r=await fetch("".concat(t,"/api/v1/auth/me"),{headers:{Authorization:"Bearer ".concat(n.authService.getAccessToken())}});if(r.ok){let e=await r.json();c({id:e.id.toString(),email:e.email,name:e.name,role:e.role,created_at:e.created_at,updated_at:e.updated_at})}else await n.authService.logout(),c(null),e()}catch(t){await n.authService.logout(),c(null),e()}finally{d(!1)}})()},[]);let h=async(e,t)=>{d(!0);try{let r=await n.authService.login({email:e,password:t});c(r.user)}catch(e){throw e}finally{d(!1)}},u=async()=>{if(!n.authService.isAuthenticated()){d(!1);return}d(!0);try{await n.authService.logout(),c(null)}catch(e){}finally{d(!1)}};return(0,s.jsx)(o.Provider,{value:{user:r,isLoading:l,isAuthenticated:!!r,login:h,logout:u},children:t})}function l(){let e=(0,a.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},3999:(e,t,r)=>{r.d(t,{cn:()=>n});var s=r(2596),a=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,s.$)(t))}},5646:(e,t,r)=>{r.d(t,{MainLayout:()=>_});var s=r(5155),a=r(2115),n=r(5695),i=r(1863),o=r(1154);function c(e){let{children:t}=e,{isAuthenticated:r,isLoading:c}=(0,i.A)(),l=(0,n.useRouter)();return((0,a.useEffect)(()=>{c||r||l.push("/login")},[r,c,l]),c)?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(o.A,{className:"h-6 w-6 animate-spin"}),(0,s.jsx)("span",{children:"Loading..."})]})}):r?(0,s.jsx)(s.Fragment,{children:t}):null}var l=r(6874),d=r.n(l),h=r(3999),u=r(7168),f=r(2713),m=r(7580),g=r(4395),x=r(3227),v=r(381),p=r(4416),b=r(4783),k=r(4835),j=r(7777);let y=[{name:"ダッシュボード",href:"/dashboard",icon:f.A},{name:"クライアント",href:"/clients",icon:m.A},{name:"案件",href:"/projects",icon:g.A},{name:"企業管理",href:"/companies",icon:x.A},{name:"設定",href:"/settings",icon:v.A}];function w(){var e;let[t,r]=(0,a.useState)(!1),o=(0,n.usePathname)(),{user:c,logout:l}=(0,i.A)(),f=async()=>{await l()};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"lg:hidden fixed top-4 left-4 z-50",children:(0,s.jsx)(u.$,{variant:"outline",size:"icon",onClick:()=>r(!t),children:t?(0,s.jsx)(p.A,{className:"h-4 w-4"}):(0,s.jsx)(b.A,{className:"h-4 w-4"})})}),(0,s.jsx)("div",{className:(0,h.cn)("fixed inset-y-0 left-0 z-40 w-64 bg-sidebar border-r border-sidebar-border transform transition-transform duration-200 ease-in-out lg:translate-x-0",t?"translate-x-0":"-translate-x-full"),children:(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)("div",{className:"flex items-center justify-center h-16 px-4 border-b border-sidebar-border",children:(0,s.jsx)("h1",{className:"text-lg font-bold text-sidebar-foreground",children:"セールスナビゲーター"})}),(0,s.jsx)("nav",{className:"flex-1 px-4 py-6 space-y-2",children:y.map(e=>{let t=o.startsWith(e.href);return(0,s.jsxs)(d(),{href:e.href,className:(0,h.cn)("flex items-center px-3 py-2 text-sm font-medium rounded-md transition-colors",t?"bg-sidebar-accent text-sidebar-accent-foreground":"text-sidebar-foreground hover:bg-sidebar-accent hover:text-sidebar-accent-foreground"),onClick:()=>r(!1),children:[(0,s.jsx)(e.icon,{className:"mr-3 h-5 w-5"}),e.name]},e.name)})}),(0,s.jsxs)("div",{className:"p-4 border-t border-sidebar-border space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"w-8 h-8 bg-sidebar-primary rounded-full flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-xs font-medium text-sidebar-primary-foreground",children:(null==c?void 0:null===(e=c.name)||void 0===e?void 0:e.charAt(0))||"U"})}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-sidebar-foreground truncate",title:(null==c?void 0:c.name)||void 0,children:(null==c?void 0:c.name)||"ユーザー"}),(null==c?void 0:c.email)?(0,s.jsxs)(j.m_,{children:[(0,s.jsx)(j.k$,{asChild:!0,children:(0,s.jsx)("p",{className:"text-xs text-muted-foreground break-all leading-snug cursor-default",title:c.email,children:c.email})}),(0,s.jsx)(j.ZI,{side:"top",align:"start",children:(0,s.jsx)("span",{children:c.email})})]}):null]})]}),(0,s.jsxs)(u.$,{"aria-label":"ログアウト",variant:"outline",size:"sm",onClick:f,className:"w-full justify-center gap-2 text-sidebar-foreground hover:text-sidebar-accent-foreground",children:[(0,s.jsx)(k.A,{className:"h-4 w-4"}),"ログアウト"]})]})]})}),t&&(0,s.jsx)("div",{className:"fixed inset-0 z-30 bg-black bg-opacity-50 lg:hidden",onClick:()=>r(!1)})]})}function _(e){let{children:t}=e;return(0,s.jsx)(c,{children:(0,s.jsxs)("div",{className:"flex h-screen bg-background",children:[(0,s.jsx)(w,{}),(0,s.jsx)("main",{className:"flex-1 lg:ml-64 overflow-auto",children:(0,s.jsx)("div",{className:"p-6 lg:p-8 pt-16 lg:pt-8",children:t})})]})})}},7168:(e,t,r)=>{r.d(t,{$:()=>c,r:()=>o});var s=r(5155);r(2115);var a=r(6634),n=r(2085),i=r(3999);let o=(0,n.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function c(e){let{className:t,variant:r,size:n,asChild:c=!1,...l}=e,d=c?a.DX:"button";return(0,s.jsx)(d,{"data-slot":"button",className:(0,i.cn)(o({variant:r,size:n,className:t})),...l})}},7777:(e,t,r)=>{r.d(t,{Bc:()=>i,ZI:()=>l,k$:()=>c,m_:()=>o});var s=r(5155);r(2115);var a=r(1668),n=r(3999);function i(e){let{delayDuration:t=0,...r}=e;return(0,s.jsx)(a.Kq,{"data-slot":"tooltip-provider",delayDuration:t,...r})}function o(e){let{...t}=e;return(0,s.jsx)(i,{children:(0,s.jsx)(a.bL,{"data-slot":"tooltip",...t})})}function c(e){let{...t}=e;return(0,s.jsx)(a.l9,{"data-slot":"tooltip-trigger",...t})}function l(e){let{className:t,sideOffset:r=0,children:i,...o}=e;return(0,s.jsx)(a.ZL,{children:(0,s.jsxs)(a.UC,{"data-slot":"tooltip-content",sideOffset:r,className:(0,n.cn)("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",t),...o,children:[i,(0,s.jsx)(a.i3,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}}}]);