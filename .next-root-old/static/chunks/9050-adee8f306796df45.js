"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9050],{98:(e,t,r)=>{r.d(t,{uE:()=>o});var a=r(9509);class s extends Error{constructor(e,t,r){super(e),this.status=t,this.response=r,this.name="ApiError"}}class n{getAuthHeaders(){let e=localStorage.getItem("access_token");return e?{Authorization:"Bearer ".concat(e)}:{}}async refreshToken(){return Promise.resolve()}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}async handleResponse(e,t,r){return this.processResponse(e)}async processResponse(e){if(!e.ok){await this.handleUnauthorized(e.status);let t="HTTP ".concat(e.status,": ").concat(e.statusText);try{let r=await e.json();t=r.message||r.error||t}catch(e){}throw new s(t,e.status,e)}let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():e.text()}async handleUnauthorized(e){if((401===e||403===e)&&!this.isHandlingUnauthorized){this.isHandlingUnauthorized=!0;try{let{authService:e}=await Promise.resolve().then(r.bind(r,1056));await e.logout()}catch(e){}finally{try{window.location.href="/login"}finally{this.isHandlingUnauthorized=!1}}}}buildUrl(e){let t=a.env.NEXT_PUBLIC_API_URL+"/api/v1";return"".concat(t).concat(e)}async makeRequest(e,t){return fetch(this.buildUrl(e),{...t,headers:{...t.headers,...this.getAuthHeaders()}})}async get(e,t){let r={method:"GET",headers:{"Content-Type":"application/json",...null==t?void 0:t.headers},...t},a=await this.makeRequest(e,r);return this.handleResponse(a,e,r)}async post(e,t,r){let a={method:"POST",headers:{"Content-Type":"application/json",...null==r?void 0:r.headers},body:t?JSON.stringify(t):void 0,...r},s=await this.makeRequest(e,a);return this.handleResponse(s,e,a)}async put(e,t,r){let a={method:"PUT",headers:{"Content-Type":"application/json",...null==r?void 0:r.headers},body:t?JSON.stringify(t):void 0,...r},s=await this.makeRequest(e,a);return this.handleResponse(s,e,a)}async patch(e,t,r){let a={method:"PATCH",headers:{"Content-Type":"application/json",...null==r?void 0:r.headers},body:t?JSON.stringify(t):void 0,...r},s=await this.makeRequest(e,a);return this.handleResponse(s,e,a)}async delete(e,t){let r={method:"DELETE",headers:{"Content-Type":"application/json",...null==t?void 0:t.headers},...t},a=await this.makeRequest(e,r);return this.handleResponse(a,e,r)}async uploadFile(e,t,r){let a=new FormData;a.append("file",t),r&&Object.entries(r).forEach(e=>{let[t,r]=e;a.append(t,String(r))});let s={method:"POST",body:a},n=await this.makeRequest(e,s);return this.handleResponse(n,e,s)}async downloadFile(e){let t=await this.makeRequest(e,{method:"GET"});if(!t.ok)throw new s("Failed to download file: ".concat(t.statusText),t.status,t);return t.blob()}constructor(){this.retryCount=0,this.maxRetries=0,this.isRefreshingToken=!1,this.refreshPromise=null,this.isHandlingUnauthorized=!1}}let o=new n},767:(e,t,r)=>{r.d(t,{B:()=>u,Y:()=>c});var a=r(2115),s=r(98),n=r(7259),o=r(1056),i=r(3398);function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,i.h)("projects:useProjects"),{page:r=1,limit:c=20,filters:u={}}=e,[l,d]=(0,a.useState)([]),[h,p]=(0,a.useState)({page:1,limit:20,total:0,total_pages:0}),[f,m]=(0,a.useState)(!0),[g,E]=(0,a.useState)(null),S=(0,a.useCallback)(async()=>{if(!o.authService.isAuthenticated()){m(!1);return}m(!0),E(null);try{let e=new URLSearchParams({page:r.toString(),limit:c.toString(),management_mode:"true"});Object.entries(u).forEach(t=>{let[r,a]=t;null!=a&&("string"!=typeof a||""!==a.trim())&&e.append(r,String(a))}),t.debug("fetchProjects: request",{params:e.toString()});let a=await s.uE.get("/projects?".concat(e.toString()));t.debug("fetchProjects: response",{count:a.count}),d(a.results||[]);let n=Math.ceil((a.count||0)/c);p({page:r,limit:c,total:a.count||0,total_pages:n})}catch(e){t.error("fetchProjects: error",{message:e instanceof Error?e.message:String(e)}),E(e instanceof Error?e.message:"エラーが発生しました"),d([]),p({page:1,limit:c,total:0,total_pages:0})}finally{m(!1)}},[u,c,r]),y=async e=>{try{return await s.uE.post(n.i3.ENDPOINTS.PROJECTS,e),await S(),t.info("createProject: success"),!0}catch(e){throw t.error("createProject: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("An error occurred")}};return(0,a.useEffect)(()=>{S()},[S]),{projects:l,pagination:h,isLoading:f,error:g,createProject:y,refetch:S}}function u(e){let t=(0,i.h)("projects:useProject",{projectId:e}),[r,c]=(0,a.useState)(null),[u,l]=(0,a.useState)(!0),[d,h]=(0,a.useState)(null),[p,f]=(0,a.useState)([]),[m,g]=(0,a.useState)(!1),E=async()=>{if(!o.authService.isAuthenticated()){l(!1);return}l(!0),h(null);try{t.debug("fetchProject: request");let r=await s.uE.get("/projects/".concat(e,"/?management_mode=true"));t.debug("fetchProject: response",{updated_at:r.updated_at}),c(r)}catch(e){t.error("fetchProject: error",{message:e instanceof Error?e.message:String(e)}),h(e instanceof Error?e.message:"エラーが発生しました"),c(null)}finally{l(!1)}},S=async r=>{try{return await s.uE.put("".concat(n.i3.ENDPOINTS.PROJECTS).concat(e,"/"),r),await E(),t.info("updateProject: success",{fields:Object.keys(r)}),!0}catch(e){throw t.error("updateProject: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},y=async(r,a)=>{try{return await s.uE.patch("".concat(n.i3.ENDPOINTS.PROJECTS).concat(e,"/companies/").concat(r,"/"),a),await E(),t.info("updateCompanyStatus: success",{companyId:r,status:a.status}),!0}catch(e){throw t.error("updateCompanyStatus: error",{companyId:r,message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},T=async r=>{try{return await s.uE.post("".concat(n.i3.ENDPOINTS.PROJECTS).concat(e,"/add-companies/"),{company_ids:r}),await E(),t.info("addCompanies: success",{companyIds:r}),!0}catch(e){throw t.error("addCompanies: error",{message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}},w=async()=>{if(o.authService.isAuthenticated()){g(!0);try{let t=await s.uE.get("/projects/".concat(e,"/available-companies/"));f(t.results||[])}catch(e){t.warn("fetchAvailableCompanies: error",{message:e instanceof Error?e.message:String(e)})}finally{g(!1)}}},P=async r=>{try{return await s.uE.delete("".concat(n.i3.ENDPOINTS.PROJECTS).concat(e,"/companies/").concat(r,"/")),await E(),t.info("removeCompany: success",{companyId:r}),!0}catch(e){throw t.error("removeCompany: error",{companyId:r,message:e instanceof Error?e.message:String(e)}),e instanceof Error?e:Error("エラーが発生しました")}};return(0,a.useEffect)(()=>{e&&(E(),w())},[e]),{project:r,isLoading:u,error:d,updateProject:S,updateCompanyStatus:y,addCompanies:T,removeCompany:P,availableCompanies:p,isLoadingAvailableCompanies:m,refetch:E}}},3398:(e,t,r)=>{r.d(t,{h:()=>i});var a=r(9509);let s={error:0,warn:1,info:2,debug:3},n=(()=>{var e;let t=(null!==(e=void 0!==a?a.env.NEXT_PUBLIC_LOG_LEVEL:void 0)&&void 0!==e?e:"info").toLowerCase();return["error","warn","info","debug"].includes(t)?t:"info"})();function o(e){return s[e]<=s[n]}function i(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1],{error(e,t){if(!o("error"))return},warn(e,t){if(!o("warn"))return},info(e,t){if(!o("info"))return},debug(e,t){if(!o("debug"))return}}}i("app")},3580:(e,t,r)=>{r.d(t,{dj:()=>h,oR:()=>d});var a=r(2115);let s=0,n=new Map,o=e=>{if(n.has(e))return;let t=setTimeout(()=>{n.delete(e),l({type:"REMOVE_TOAST",toastId:e})},1e6);n.set(e,t)},i=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:r}=t;return r?o(r):e.toasts.forEach(e=>{o(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===r||void 0===r?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],u={toasts:[]};function l(e){u=i(u,e),c.forEach(e=>{e(u)})}function d(e){let{...t}=e,r=(s=(s+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>l({type:"DISMISS_TOAST",toastId:r});return l({type:"ADD_TOAST",toast:{...t,id:r,open:!0,onOpenChange:e=>{e||a()}}}),{id:r,dismiss:a,update:e=>l({type:"UPDATE_TOAST",toast:{...e,id:r}})}}function h(){let[e,t]=a.useState(u);return a.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:d,dismiss:e=>l({type:"DISMISS_TOAST",toastId:e})}}}}]);