(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6952],{88:(e,t,s)=>{"use strict";s.d(t,{d:()=>n});var a=s(5155);s(2115);var r=s(7161),i=s(3999);function n(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"switch",className:(0,i.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(r.zi,{"data-slot":"switch-thumb",className:(0,i.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},2714:(e,t,s)=>{"use strict";s.d(t,{J:()=>n});var a=s(5155);s(2115);var r=s(2797),i=s(3999);function n(e){let{className:t,...s}=e;return(0,a.jsx)(r.b,{"data-slot":"label",className:(0,i.cn)("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",t),...s})}},3580:(e,t,s)=>{"use strict";s.d(t,{dj:()=>h,oR:()=>u});var a=s(2115);let r=0,i=new Map,n=e=>{if(i.has(e))return;let t=setTimeout(()=>{i.delete(e),o({type:"REMOVE_TOAST",toastId:e})},1e6);i.set(e,t)},l=(e,t)=>{switch(t.type){case"ADD_TOAST":return{...e,toasts:[t.toast,...e.toasts].slice(0,1)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(e=>e.id===t.toast.id?{...e,...t.toast}:e)};case"DISMISS_TOAST":{let{toastId:s}=t;return s?n(s):e.toasts.forEach(e=>{n(e.id)}),{...e,toasts:e.toasts.map(e=>e.id===s||void 0===s?{...e,open:!1}:e)}}case"REMOVE_TOAST":if(void 0===t.toastId)return{...e,toasts:[]};return{...e,toasts:e.toasts.filter(e=>e.id!==t.toastId)}}},c=[],d={toasts:[]};function o(e){d=l(d,e),c.forEach(e=>{e(d)})}function u(e){let{...t}=e,s=(r=(r+1)%Number.MAX_SAFE_INTEGER).toString(),a=()=>o({type:"DISMISS_TOAST",toastId:s});return o({type:"ADD_TOAST",toast:{...t,id:s,open:!0,onOpenChange:e=>{e||a()}}}),{id:s,dismiss:a,update:e=>o({type:"UPDATE_TOAST",toast:{...e,id:s}})}}function h(){let[e,t]=a.useState(d);return a.useEffect(()=>(c.push(t),()=>{let e=c.indexOf(t);e>-1&&c.splice(e,1)}),[e]),{...e,toast:u,dismiss:e=>o({type:"DISMISS_TOAST",toastId:e})}}},3983:(e,t,s)=>{"use strict";s.d(t,{B:()=>o,Kz:()=>d,aq:()=>l,tH:()=>c});var a=s(2115),r=s(7259);let i=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]},n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]};function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{page:t=1,limit:s=50,filters:l={}}=e,[c,d]=(0,a.useState)([]),[o,u]=(0,a.useState)(!0),[h,x]=(0,a.useState)(null),[p,j]=(0,a.useState)({page:1,limit:50,total:0,total_pages:1}),v=async()=>{try{u(!0),x(null);let e=new URLSearchParams({page:t.toString(),page_size:s.toString(),...Object.fromEntries(Object.entries(l).filter(e=>{let[t,s]=e;return void 0!==s&&""!==s&&("industry"!==t||"all"!==s)}))}),a=await r.uE.get("/clients?".concat(e));i("一覧レスポンス",a);let c=await a.json();i("APIレスポンス構造",c),c&&"object"==typeof c?Array.isArray(c.results)?(d(c.results),j({page:t,limit:s,total:c.count||0,total_pages:Math.ceil((c.count||0)/s)})):Array.isArray(c)?(d(c),j({page:t,limit:s,total:c.length,total_pages:Math.ceil(c.length/s)})):(n("Unexpected response format",c),x("予期しないAPIレスポンス形式")):x("APIからデータを取得できませんでした")}catch(e){x(e instanceof Error?e.message:"クライアント一覧の取得に失敗しました")}finally{u(!1)}};(0,a.useEffect)(()=>{v()},[t,s,JSON.stringify(l)]);let m=async e=>{try{i("クライアント作成",e);let t=await r.uE.post("/clients/",e);if(t.ok){let e=await t.json();return i("クライアント作成成功",e),await v(),e}throw Error("クライアントの作成に失敗しました")}catch(e){throw e}},g=async(e,t)=>{try{i("クライアント更新",{id:e,clientData:t});let s=await r.uE.put("/clients/".concat(e,"/"),t);if(s.ok){let e=await s.json();return i("クライアント更新成功",e),await v(),e}throw Error("クライアントの更新に失敗しました")}catch(e){throw e}};return{clients:c,loading:o,error:h,pagination:p,refetch:v,createClient:m,updateClient:g}}function c(e){let[t,s]=(0,a.useState)(null),[n,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),i("クライアント詳細を取得",{id:e});let t=await r.uE.get("/clients/".concat(e));if(t.ok){let e=await t.json();i("クライアント詳細取得成功",e),e&&e.id?s(e):d("クライアント詳細データが見つかりません")}else throw Error("クライアント詳細の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"クライアント詳細の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{client:t,loading:n,error:c,refetch:o}}function d(e){let[t,s]=(0,a.useState)(null),[n,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),i("クライアント統計情報を取得",{id:e});let t=await r.uE.get("/clients/".concat(e,"/stats"));if(t.ok){let e=await t.json();i("クライアント統計情報取得成功",e),e?s(e):d("統計情報が見つかりません")}else throw Error("統計情報の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"統計情報の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{stats:t,loading:n,error:c,refetch:o}}function o(e){let[t,s]=(0,a.useState)([]),[n,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),i("クライアント関連案件を取得",{id:e});let t=await r.uE.get("/clients/".concat(e,"/projects"));if(t.ok){let e=await t.json();i("クライアント関連案件取得成功",e),e&&Array.isArray(e.results)?s(e.results):e&&Array.isArray(e)?s(e):d("関連案件データが見つかりません")}else throw Error("関連案件の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"関連案件の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{projects:t,loading:n,error:c,refetch:o}}},4271:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>E});var a=s(5155),r=s(2115),i=s(5695),n=s(5646),l=s(7168),c=s(8482),d=s(9852),o=s(5784),u=s(8145),h=s(5139),x=s(8524),p=s(7777),j=s(2714),v=s(7550),m=s(4616),g=s(1482),f=s(7924),b=s(1243),y=s(3580),S=s(3983),w=s(7259),N=s(88);function E(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{toast:s}=(0,y.dj)(),E=Number.parseInt(e.id),{client:k,loading:A}=(0,S.tH)(E),[_,T]=(0,r.useState)([]),[C,I]=(0,r.useState)(new Set),[O,z]=(0,r.useState)(!1),[D,M]=(0,r.useState)({page:1,page_size:100,exclude_ng:!1}),[P,R]=(0,r.useState)(0),[F,G]=(0,r.useState)([]),[L,$]=(0,r.useState)(null),[J,B]=(0,r.useState)(!1),[U,V]=(0,r.useState)(!1),[Z,q]=(0,r.useState)(""),H=async()=>{if(E){z(!0);try{let e=new URLSearchParams;Object.entries(D).forEach(t=>{let[s,a]=t;null!=a&&e.append(s,String(a))});let t=await w.uE.get("/clients/".concat(E,"/available-companies?").concat(e.toString())),s=await t.json();(null==s?void 0:s.results)&&(T(s.results),R(s.count||0))}catch(e){s({title:"エラー",description:"企業データの取得に失敗しました",variant:"destructive"})}finally{z(!1)}}},W=async()=>{if(E)try{let e=await w.uE.get("/clients/".concat(E,"/projects")),t=await e.json();G((null==t?void 0:t.results)||[])}catch(e){}};(0,r.useEffect)(()=>{E&&(H(),W())},[E]),(0,r.useEffect)(()=>{E&&H()},[D.page,D.page_size,D.search,D.industry,D.exclude_ng]);let X=(e,t)=>{var a;let r=_.find(t=>t.id===e);if(null==r?void 0:null===(a=r.ng_status)||void 0===a?void 0:a.is_ng){s({title:"選択できません",description:"この企業はNGリストに登録されています",variant:"destructive"});return}let i=new Set(C);t?i.add(e):i.delete(e),I(i)},K=async()=>{if(0===C.size){s({title:"エラー",description:"企業を選択してください",variant:"destructive"});return}if(!L){s({title:"エラー",description:"案件を選択してください",variant:"destructive"});return}B(!0);try{if(!(await w.uE.post("/projects/".concat(L,"/add-companies/"),{company_ids:Array.from(C)})).ok)throw Error("Failed to add companies");s({title:"成功",description:"".concat(C.size,"社を案件に追加しました")}),t.push("/projects/".concat(L))}catch(e){s({title:"エラー",description:"企業追加に失敗しました",variant:"destructive"})}finally{B(!1)}},Q=async()=>{if(0===C.size){s({title:"エラー",description:"企業を選択してください",variant:"destructive"});return}if(!Z.trim()){s({title:"エラー",description:"案件名を入力してください",variant:"destructive"});return}B(!0);try{let e=await w.uE.post("/projects/",{name:Z.trim(),client_id:E,status:"active",start_date:new Date().toISOString().split("T")[0]});if(!e.ok)throw Error("Failed to create project");let a=(await e.json()).id;if(!(await w.uE.post("/projects/".concat(a,"/add-companies/"),{company_ids:Array.from(C)})).ok)throw Error("Failed to add companies to project");s({title:"成功",description:"新規案件「".concat(Z,"」を作成し、").concat(C.size,"社を追加しました")}),t.push("/projects/".concat(a))}catch(e){s({title:"エラー",description:"新規案件作成に失敗しました",variant:"destructive"})}finally{B(!1)}};return A?(0,a.jsx)("div",{className:"p-6",children:"読み込み中..."}):(0,a.jsx)(n.MainLayout,{children:(0,a.jsx)(p.Bc,{children:(0,a.jsxs)("div",{className:"p-6 space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(l.$,{variant:"ghost",size:"icon",onClick:()=>t.back(),children:(0,a.jsx)(v.A,{className:"h-4 w-4"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"営業対象企業を選択"}),(0,a.jsxs)("p",{className:"text-muted-foreground",children:[null==k?void 0:k.name," 様の案件用企業選択"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)(u.E,{variant:"secondary",children:[C.size,"社選択中"]}),!U&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(o.l6,{value:(null==L?void 0:L.toString())||"",onValueChange:e=>$(Number(e)),children:[(0,a.jsx)(o.bq,{className:"w-48",children:(0,a.jsx)(o.yv,{placeholder:"既存案件を選択"})}),(0,a.jsx)(o.gC,{children:F.map(e=>(0,a.jsx)(o.eb,{value:e.id.toString(),children:e.name},e.id))})]}),(0,a.jsxs)(l.$,{disabled:0===C.size||!L||J,onClick:K,variant:"default",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),J?"追加中...":"既存案件に追加"]}),(0,a.jsx)(l.$,{variant:"outline",onClick:()=>V(!0),disabled:0===C.size,children:"新規案件作成"})]}),U&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.p,{placeholder:"新規案件名を入力",value:Z,onChange:e=>q(e.target.value),className:"w-64"}),(0,a.jsxs)(l.$,{disabled:0===C.size||!Z.trim()||J,onClick:Q,variant:"default",children:[(0,a.jsx)(m.A,{className:"h-4 w-4 mr-2"}),J?"作成中...":"案件作成して追加"]}),(0,a.jsx)(l.$,{variant:"outline",onClick:()=>{V(!1),q("")},disabled:J,children:"キャンセル"})]})]})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{className:"flex items-center",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 mr-2"}),"検索・フィルタ"]})}),(0,a.jsx)(c.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)(j.J,{children:"企業名検索"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(f.A,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,a.jsx)(d.p,{placeholder:"企業名で検索",className:"pl-10",value:D.search||"",onChange:e=>M(t=>({...t,search:e.target.value,page:1}))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j.J,{children:"業界"}),(0,a.jsxs)(o.l6,{value:D.industry||"all",onValueChange:e=>M(t=>({...t,industry:"all"===e?void 0:e,page:1})),children:[(0,a.jsx)(o.bq,{children:(0,a.jsx)(o.yv,{placeholder:"業界を選択"})}),(0,a.jsxs)(o.gC,{children:[(0,a.jsx)(o.eb,{value:"all",children:"すべて"}),(0,a.jsx)(o.eb,{value:"IT・ソフトウェア",children:"IT・ソフトウェア"}),(0,a.jsx)(o.eb,{value:"製造業",children:"製造業"}),(0,a.jsx)(o.eb,{value:"商社・流通",children:"商社・流通"}),(0,a.jsx)(o.eb,{value:"金融・保険",children:"金融・保険"}),(0,a.jsx)(o.eb,{value:"建設・不動産",children:"建設・不動産"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)(j.J,{children:"都道府県"}),(0,a.jsxs)(o.l6,{value:D.prefecture||"all",onValueChange:e=>M(t=>({...t,prefecture:"all"===e?void 0:e,page:1})),children:[(0,a.jsx)(o.bq,{children:(0,a.jsx)(o.yv,{placeholder:"都道府県を選択"})}),(0,a.jsxs)(o.gC,{children:[(0,a.jsx)(o.eb,{value:"all",children:"すべて"}),(0,a.jsx)(o.eb,{value:"東京都",children:"東京都"}),(0,a.jsx)(o.eb,{value:"大阪府",children:"大阪府"}),(0,a.jsx)(o.eb,{value:"愛知県",children:"愛知県"}),(0,a.jsx)(o.eb,{value:"神奈川県",children:"神奈川県"})]})]})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsx)(l.$,{variant:"outline",onClick:()=>M({page:1,page_size:100,exclude_ng:!1}),children:"クリア"})}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N.d,{id:"exclude-ng",checked:!!D.exclude_ng,onCheckedChange:e=>M(t=>({...t,exclude_ng:!!e,page:1}))}),(0,a.jsx)(j.J,{htmlFor:"exclude-ng",className:"text-sm",children:"NG企業を除外"})]})]})})]}),(0,a.jsxs)(c.Zp,{children:[(0,a.jsx)(c.aR,{children:(0,a.jsxs)(c.ZB,{children:["企業一覧 (",P.toLocaleString(),"社)"]})}),(0,a.jsx)(c.Wu,{children:O?(0,a.jsx)("div",{className:"text-center py-8",children:"読み込み中..."}):(0,a.jsxs)(x.XI,{children:[(0,a.jsx)(x.A0,{children:(0,a.jsxs)(x.Hj,{children:[(0,a.jsx)(x.nd,{className:"w-12",children:"選択"}),(0,a.jsx)(x.nd,{children:"企業名"}),(0,a.jsx)(x.nd,{children:"業界"}),(0,a.jsx)(x.nd,{children:"従業員数"}),(0,a.jsx)(x.nd,{children:"都道府県"}),(0,a.jsx)(x.nd,{children:"NG状態"})]})}),(0,a.jsx)(x.BF,{children:_.map(e=>{var t,s,r,i,n,l;let c=null===(t=e.ng_status)||void 0===t?void 0:t.is_ng,d=C.has(e.id);return(0,a.jsxs)(x.Hj,{className:c?"bg-red-50 opacity-60":"",children:[(0,a.jsx)(x.nA,{children:(0,a.jsx)(h.S,{checked:d,disabled:c,onCheckedChange:t=>X(e.id,t)})}),(0,a.jsx)(x.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{className:c?"text-muted-foreground":"",children:e.name}),c&&(0,a.jsxs)(p.m_,{children:[(0,a.jsx)(p.k$,{children:(0,a.jsx)(b.A,{className:"h-4 w-4 text-red-500"})}),(0,a.jsx)(p.ZI,{children:(0,a.jsxs)("div",{className:"space-y-1",children:[(0,a.jsx)("p",{className:"font-medium",children:"NG企業"}),(null===(r=e.ng_status)||void 0===r?void 0:null===(s=r.reasons)||void 0===s?void 0:s.global)&&(0,a.jsxs)("p",{className:"text-sm",children:["グローバルNG: ",e.ng_status.reasons.global]}),(null===(n=e.ng_status)||void 0===n?void 0:null===(i=n.reasons)||void 0===i?void 0:i.client)&&(0,a.jsxs)("p",{className:"text-sm",children:["クライアントNG: ",e.ng_status.reasons.client.reason]})]})})]})]})}),(0,a.jsx)(x.nA,{className:c?"text-muted-foreground":"",children:e.industry}),(0,a.jsxs)(x.nA,{className:c?"text-muted-foreground":"",children:[null===(l=e.employee_count)||void 0===l?void 0:l.toLocaleString(),"人"]}),(0,a.jsx)(x.nA,{className:c?"text-muted-foreground":"",children:e.prefecture}),(0,a.jsx)(x.nA,{children:c?(0,a.jsx)(u.E,{variant:"destructive",children:"NG"}):(0,a.jsx)(u.E,{variant:"secondary",children:"選択可能"})})]},e.id)})})]})})]})]})})})}},5139:(e,t,s)=>{"use strict";s.d(t,{S:()=>l});var a=s(5155);s(2115);var r=s(8030),i=s(5196),n=s(3999);function l(e){let{className:t,...s}=e;return(0,a.jsx)(r.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(r.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(i.A,{className:"size-3.5"})})})}},8407:(e,t,s)=>{Promise.resolve().then(s.bind(s,4271))}},e=>{var t=t=>e(e.s=t);e.O(0,[8823,7715,7501,2717,2286,6358,8482,5646,7869,8441,1684,7358],()=>t(8407)),_N_E=e.O()}]);