(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5021],{98:(e,t,s)=>{"use strict";s.d(t,{uE:()=>i});var a=s(9509);class n extends Error{constructor(e,t,s){super(e),this.status=t,this.response=s,this.name="ApiError"}}class r{getAuthHeaders(){let e=localStorage.getItem("access_token");return e?{Authorization:"Bearer ".concat(e)}:{}}async refreshToken(){return Promise.resolve()}clearTokens(){localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}async handleResponse(e,t,s){return this.processResponse(e)}async processResponse(e){if(!e.ok){await this.handleUnauthorized(e.status);let t="HTTP ".concat(e.status,": ").concat(e.statusText);try{let s=await e.json();t=s.message||s.error||t}catch(e){}throw new n(t,e.status,e)}let t=e.headers.get("content-type");return t&&t.includes("application/json")?e.json():e.text()}async handleUnauthorized(e){if((401===e||403===e)&&!this.isHandlingUnauthorized){this.isHandlingUnauthorized=!0;try{let{authService:e}=await Promise.resolve().then(s.bind(s,1056));await e.logout()}catch(e){}finally{try{window.location.href="/login"}finally{this.isHandlingUnauthorized=!1}}}}buildUrl(e){let t=a.env.NEXT_PUBLIC_API_URL+"/api/v1";return"".concat(t).concat(e)}async makeRequest(e,t){return fetch(this.buildUrl(e),{...t,headers:{...t.headers,...this.getAuthHeaders()}})}async get(e,t){let s={method:"GET",headers:{"Content-Type":"application/json",...null==t?void 0:t.headers},...t},a=await this.makeRequest(e,s);return this.handleResponse(a,e,s)}async post(e,t,s){let a={method:"POST",headers:{"Content-Type":"application/json",...null==s?void 0:s.headers},body:t?JSON.stringify(t):void 0,...s},n=await this.makeRequest(e,a);return this.handleResponse(n,e,a)}async put(e,t,s){let a={method:"PUT",headers:{"Content-Type":"application/json",...null==s?void 0:s.headers},body:t?JSON.stringify(t):void 0,...s},n=await this.makeRequest(e,a);return this.handleResponse(n,e,a)}async patch(e,t,s){let a={method:"PATCH",headers:{"Content-Type":"application/json",...null==s?void 0:s.headers},body:t?JSON.stringify(t):void 0,...s},n=await this.makeRequest(e,a);return this.handleResponse(n,e,a)}async delete(e,t){let s={method:"DELETE",headers:{"Content-Type":"application/json",...null==t?void 0:t.headers},...t},a=await this.makeRequest(e,s);return this.handleResponse(a,e,s)}async uploadFile(e,t,s){let a=new FormData;a.append("file",t),s&&Object.entries(s).forEach(e=>{let[t,s]=e;a.append(t,String(s))});let n={method:"POST",body:a},r=await this.makeRequest(e,n);return this.handleResponse(r,e,n)}async downloadFile(e){let t=await this.makeRequest(e,{method:"GET"});if(!t.ok)throw new n("Failed to download file: ".concat(t.statusText),t.status,t);return t.blob()}constructor(){this.retryCount=0,this.maxRetries=0,this.isRefreshingToken=!1,this.refreshPromise=null,this.isHandlingUnauthorized=!1}}let i=new r},3983:(e,t,s)=>{"use strict";s.d(t,{B:()=>o,Kz:()=>d,aq:()=>l,tH:()=>c});var a=s(2115),n=s(7259);let r=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]},i=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]};function l(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{page:t=1,limit:s=50,filters:l={}}=e,[c,d]=(0,a.useState)([]),[o,h]=(0,a.useState)(!0),[u,m]=(0,a.useState)(null),[x,j]=(0,a.useState)({page:1,limit:50,total:0,total_pages:1}),p=async()=>{try{h(!0),m(null);let e=new URLSearchParams({page:t.toString(),page_size:s.toString(),...Object.fromEntries(Object.entries(l).filter(e=>{let[t,s]=e;return void 0!==s&&""!==s&&("industry"!==t||"all"!==s)}))}),a=await n.uE.get("/clients?".concat(e));r("一覧レスポンス",a);let c=await a.json();r("APIレスポンス構造",c),c&&"object"==typeof c?Array.isArray(c.results)?(d(c.results),j({page:t,limit:s,total:c.count||0,total_pages:Math.ceil((c.count||0)/s)})):Array.isArray(c)?(d(c),j({page:t,limit:s,total:c.length,total_pages:Math.ceil(c.length/s)})):(i("Unexpected response format",c),m("予期しないAPIレスポンス形式")):m("APIからデータを取得できませんでした")}catch(e){m(e instanceof Error?e.message:"クライアント一覧の取得に失敗しました")}finally{h(!1)}};(0,a.useEffect)(()=>{p()},[t,s,JSON.stringify(l)]);let f=async e=>{try{r("クライアント作成",e);let t=await n.uE.post("/clients/",e);if(t.ok){let e=await t.json();return r("クライアント作成成功",e),await p(),e}throw Error("クライアントの作成に失敗しました")}catch(e){throw e}},v=async(e,t)=>{try{r("クライアント更新",{id:e,clientData:t});let s=await n.uE.put("/clients/".concat(e,"/"),t);if(s.ok){let e=await s.json();return r("クライアント更新成功",e),await p(),e}throw Error("クライアントの更新に失敗しました")}catch(e){throw e}};return{clients:c,loading:o,error:u,pagination:x,refetch:p,createClient:f,updateClient:v}}function c(e){let[t,s]=(0,a.useState)(null),[i,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),r("クライアント詳細を取得",{id:e});let t=await n.uE.get("/clients/".concat(e));if(t.ok){let e=await t.json();r("クライアント詳細取得成功",e),e&&e.id?s(e):d("クライアント詳細データが見つかりません")}else throw Error("クライアント詳細の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"クライアント詳細の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{client:t,loading:i,error:c,refetch:o}}function d(e){let[t,s]=(0,a.useState)(null),[i,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),r("クライアント統計情報を取得",{id:e});let t=await n.uE.get("/clients/".concat(e,"/stats"));if(t.ok){let e=await t.json();r("クライアント統計情報取得成功",e),e?s(e):d("統計情報が見つかりません")}else throw Error("統計情報の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"統計情報の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{stats:t,loading:i,error:c,refetch:o}}function o(e){let[t,s]=(0,a.useState)([]),[i,l]=(0,a.useState)(!0),[c,d]=(0,a.useState)(null),o=async()=>{try{l(!0),d(null),r("クライアント関連案件を取得",{id:e});let t=await n.uE.get("/clients/".concat(e,"/projects"));if(t.ok){let e=await t.json();r("クライアント関連案件取得成功",e),e&&Array.isArray(e.results)?s(e.results):e&&Array.isArray(e)?s(e):d("関連案件データが見つかりません")}else throw Error("関連案件の取得に失敗しました")}catch(e){d(e instanceof Error?e.message:"関連案件の取得に失敗しました")}finally{l(!1)}};return(0,a.useEffect)(()=>{e&&o()},[e]),{projects:t,loading:i,error:c,refetch:o}}},6530:(e,t,s)=>{Promise.resolve().then(s.bind(s,7717))},7717:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>H});var a=s(5155),n=s(2115),r=s(5695),i=s(3983),l=s(98),c=s(6874),d=s.n(c),o=s(8524),h=s(8145),u=s(7168),m=s(1544),x=s(3999);function j(e){let{...t}=e;return(0,a.jsx)(m.bL,{"data-slot":"dropdown-menu",...t})}function p(e){let{...t}=e;return(0,a.jsx)(m.l9,{"data-slot":"dropdown-menu-trigger",...t})}function f(e){let{className:t,sideOffset:s=4,...n}=e;return(0,a.jsx)(m.ZL,{children:(0,a.jsx)(m.UC,{"data-slot":"dropdown-menu-content",sideOffset:s,className:(0,x.cn)("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",t),...n})})}function v(e){let{className:t,inset:s,variant:n="default",...r}=e;return(0,a.jsx)(m.q7,{"data-slot":"dropdown-menu-item","data-inset":s,"data-variant":n,className:(0,x.cn)("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",t),...r})}var g=s(5623),y=s(2657),w=s(3717),N=s(4395),b=s(9022),A=s(4008),_=s(8885);function E(e){let{clients:t,loading:s}=e,n=(0,r.useRouter)();return s?(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,t)=>(0,a.jsx)("div",{className:"h-16 bg-gray-100 rounded animate-pulse"},t))}):0===t.length?(0,a.jsx)("div",{className:"text-center py-12",children:(0,a.jsx)("p",{className:"text-gray-500",children:"クライアントが見つかりません"})}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(o.XI,{children:[(0,a.jsx)(o.A0,{children:(0,a.jsxs)(o.Hj,{children:[(0,a.jsx)(o.nd,{children:"クライアント名"}),(0,a.jsx)(o.nd,{children:"担当者"}),(0,a.jsx)(o.nd,{children:"業界"}),(0,a.jsx)(o.nd,{children:"案件数"}),(0,a.jsx)(o.nd,{children:"進行中"}),(0,a.jsx)(o.nd,{children:"ステータス"}),(0,a.jsx)(o.nd,{children:"登録日"}),(0,a.jsx)(o.nd,{className:"w-[100px]",children:"アクション"})]})}),(0,a.jsx)(o.BF,{children:t.map(e=>(0,a.jsxs)(o.Hj,{children:[(0,a.jsx)(o.nA,{className:"font-medium",children:(0,a.jsxs)(d(),{href:"/clients/".concat(e.id),className:"block group focus:outline-none focus-visible:ring-2 focus-visible:ring-ring rounded-sm",children:[(0,a.jsx)("div",{className:"font-semibold text-foreground group-hover:text-blue-600",children:e.name}),e.email&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,a.jsx)(o.nA,{children:e.contact_person||"-"}),(0,a.jsx)(o.nA,{children:e.industry||"-"}),(0,a.jsx)(o.nA,{children:(0,a.jsx)("span",{className:"font-medium",children:e.project_count||0})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)("span",{className:"font-medium text-blue-600",children:e.active_project_count||0})}),(0,a.jsx)(o.nA,{children:(0,a.jsx)(h.E,{variant:e.is_active?"default":"secondary",children:e.is_active?"アクティブ":"非アクティブ"})}),(0,a.jsx)(o.nA,{children:(0,A.GP)(new Date(e.created_at),"yyyy/MM/dd",{locale:_.ja})}),(0,a.jsx)(o.nA,{children:(0,a.jsxs)(j,{children:[(0,a.jsx)(p,{asChild:!0,children:(0,a.jsx)(u.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,a.jsx)(g.A,{className:"h-4 w-4"})})}),(0,a.jsxs)(f,{align:"end",children:[(0,a.jsxs)(v,{onClick:()=>n.push("/clients/".concat(e.id)),children:[(0,a.jsx)(y.A,{className:"mr-2 h-4 w-4"}),"詳細表示"]}),(0,a.jsxs)(v,{onClick:()=>n.push("/clients/".concat(e.id,"/edit")),children:[(0,a.jsx)(w.A,{className:"mr-2 h-4 w-4"}),"編集"]}),(0,a.jsxs)(v,{onClick:()=>n.push("/clients/".concat(e.id,"/projects")),children:[(0,a.jsx)(N.A,{className:"mr-2 h-4 w-4"}),"案件一覧"]}),(0,a.jsxs)(v,{children:[(0,a.jsx)(b.A,{className:"mr-2 h-4 w-4"}),"アーカイブ"]})]})]})})]},e.id))})]})})}var k=s(9852),S=s(5784),R=s(8482),C=s(7580),T=s(3109),P=s(4616),z=s(1482),O=s(7924),U=s(5646);let q={search:"",industry:"all",is_active:"all"};function H(){var e;let t=(0,r.useRouter)(),[s,c]=(0,n.useState)([]),[d,o]=(0,n.useState)(q),[h,m]=(0,n.useState)(q),x=(0,n.useMemo)(()=>{let e={};return h.search.trim()&&(e.search=h.search.trim()),"all"!==h.industry&&(e.industry=h.industry),"true"===h.is_active&&(e.is_active=!0),"false"===h.is_active&&(e.is_active=!1),e},[h]),j=(0,n.useMemo)(()=>Object.keys(x).length>0,[x]),p=(0,n.useMemo)(()=>JSON.stringify(d)!==JSON.stringify(h),[d,h]),{clients:f,loading:v,error:g,pagination:y}=(0,i.aq)({page:1,limit:100,filters:x});(0,n.useEffect)(()=>{(async()=>{try{let e=await l.uE.get("/master/industries/");c(e.results||[])}catch(e){}})()},[]);let w=f.filter(e=>e.is_active).length,b=f.reduce((e,t)=>e+(t.project_count||0),0),A=f.reduce((e,t)=>e+(t.active_project_count||0),0);return(0,a.jsx)(U.MainLayout,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-start",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"クライアント管理"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"クライアント企業の情報と営業状況を効率的に管理"}),(0,a.jsxs)("div",{className:"flex items-center gap-6 mt-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(C.A,{className:"h-4 w-4 text-blue-600"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["アクティブクライアント: ",(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[w,"社"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(N.A,{className:"h-4 w-4 text-green-600"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["進行中案件: ",(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[A,"件"]})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(T.A,{className:"h-4 w-4 text-purple-600"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["総案件数: ",(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:[b,"件"]})]})]})]})]}),(0,a.jsxs)(u.$,{onClick:()=>t.push("/clients/new"),size:"lg",children:[(0,a.jsx)(P.A,{className:"mr-2 h-4 w-4"}),"新規クライアント登録"]})]}),(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(z.A,{className:"h-5 w-5"}),"検索・フィルタ"]})}),(0,a.jsx)(R.Wu,{children:(0,a.jsxs)("div",{className:"grid grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"クライアント名"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(O.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),(0,a.jsx)(k.p,{placeholder:"クライアント名で検索",value:d.search,onChange:e=>o(t=>({...t,search:e.target.value})),className:"pl-10"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"業界"}),(0,a.jsxs)(S.l6,{value:d.industry,onValueChange:e=>o(t=>({...t,industry:e})),children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"業界を選択"})}),(0,a.jsxs)(S.gC,{children:[(0,a.jsx)(S.eb,{value:"all",children:"すべて"}),s.map(e=>(0,a.jsx)(S.eb,{value:e.name,children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"ステータス"}),(0,a.jsxs)(S.l6,{value:d.is_active,onValueChange:e=>o(t=>({...t,is_active:e})),children:[(0,a.jsx)(S.bq,{children:(0,a.jsx)(S.yv,{placeholder:"ステータス"})}),(0,a.jsxs)(S.gC,{children:[(0,a.jsx)(S.eb,{value:"all",children:"すべて"}),(0,a.jsx)(S.eb,{value:"true",children:"アクティブ"}),(0,a.jsx)(S.eb,{value:"false",children:"非アクティブ"})]})]})]}),(0,a.jsx)("div",{className:"flex items-end",children:(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)(u.$,{variant:"outline",onClick:()=>{o(q),m(q)},disabled:!j&&!p,children:"フィルタクリア"}),(0,a.jsxs)(u.$,{onClick:()=>m({...d}),disabled:!p,children:[(0,a.jsx)(O.A,{className:"mr-2 h-4 w-4"}),"検索"]})]})})]})})]}),(0,a.jsxs)(R.Zp,{children:[(0,a.jsx)(R.aR,{children:(0,a.jsxs)(R.ZB,{children:["クライアント一覧 (",null!==(e=y.total)&&void 0!==e?e:f.length,"件)"]})}),(0,a.jsx)(R.Wu,{children:g?(0,a.jsxs)("div",{className:"text-center py-8 text-red-600",children:["エラー: ",g]}):(0,a.jsx)(E,{clients:f,loading:v})})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8823,7715,7501,2717,2286,9587,5646,7869,8441,1684,7358],()=>t(6530)),_N_E=e.O()}]);