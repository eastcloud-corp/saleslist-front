(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8974],{1056:(e,t,r)=>{"use strict";r.d(t,{authService:()=>n});var s=r(9509);class a{static getInstance(){return a.instance||(a.instance=new a),a.instance}async login(e){try{let t=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/login/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error("ログインに失敗しました");let r=await t.json();if(r.access_token&&r.refresh_token)return this.setTokens(r.access_token,r.refresh_token),r;throw Error("ログインに失敗しました - 無効なレスポンス形式")}catch(e){throw e}}async logout(){try{let e=this.getRefreshToken();await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/logout/"),{method:"POST",headers:{"Content-Type":"application/json",...this.getAuthHeaders()},body:JSON.stringify({refresh_token:e})})}catch(e){}finally{this.clearTokens()}}async refreshAccessToken(){if(!this.refreshToken)throw Error("リフレッシュトークンが利用できません");let e=await fetch("".concat(s.env.NEXT_PUBLIC_API_URL,"/api/v1/auth/refresh/"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:this.refreshToken})});if(!e.ok)throw this.clearTokens(),Error("トークンの更新に失敗しました");let t=await e.json();if(t.access_token)return this.accessToken=t.access_token,this.accessToken&&localStorage.setItem("access_token",this.accessToken),this.accessToken||"";throw Error("トークンの更新に失敗しました")}setTokens(e,t){this.accessToken=e,this.refreshToken=t,localStorage.setItem("access_token",e),localStorage.setItem("refresh_token",t)}clearTokens(){this.accessToken=null,this.refreshToken=null,localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")}getAuthHeaders(){return this.accessToken?{Authorization:"Bearer ".concat(this.accessToken)}:{}}isAuthenticated(){return!!this.accessToken}getAccessToken(){return this.accessToken}getRefreshToken(){return this.refreshToken}constructor(){this.accessToken=null,this.refreshToken=null,this.accessToken=localStorage.getItem("access_token"),this.refreshToken=localStorage.getItem("refresh_token")}}let n=a.getInstance()},1057:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>i});var s=r(5155),a=r(2115),n=r(5695),o=r(1863),c=r(1154);function i(){let{isAuthenticated:e,isLoading:t}=(0,o.A)(),r=(0,n.useRouter)();return(0,a.useEffect)(()=>{t||(e?r.push("/clients"):r.push("/login"))},[e,t,r]),(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(c.A,{className:"h-6 w-6 animate-spin"}),(0,s.jsx)("span",{children:"Loading..."})]})})}},1154:(e,t,r)=>{"use strict";r.d(t,{A:()=>s});let s=(0,r(9946).A)("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},1863:(e,t,r)=>{"use strict";r.d(t,{A:()=>h,AuthProvider:()=>i});var s=r(5155),a=r(2115),n=r(1056),o=r(9509);let c=(0,a.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,a.useState)(null),[h,l]=(0,a.useState)(!0);(0,a.useEffect)(()=>{let e=()=>{window.location.pathname.startsWith("/login")||(window.location.href="/login")};(async()=>{try{if(!n.authService.isAuthenticated()){i(null),e();return}let t=o.env.NEXT_PUBLIC_API_URL;if(!t)throw Error("NEXT_PUBLIC_API_URL is not configured");let r=await fetch("".concat(t,"/api/v1/auth/me"),{headers:{Authorization:"Bearer ".concat(n.authService.getAccessToken())}});if(r.ok){let e=await r.json();i({id:e.id.toString(),email:e.email,name:e.name,role:e.role,created_at:e.created_at,updated_at:e.updated_at})}else await n.authService.logout(),i(null),e()}catch(t){await n.authService.logout(),i(null),e()}finally{l(!1)}})()},[]);let u=async(e,t)=>{l(!0);try{let r=await n.authService.login({email:e,password:t});i(r.user)}catch(e){throw e}finally{l(!1)}},f=async()=>{if(!n.authService.isAuthenticated()){l(!1);return}l(!0);try{await n.authService.logout(),i(null)}catch(e){}finally{l(!1)}};return(0,s.jsx)(c.Provider,{value:{user:r,isLoading:h,isAuthenticated:!!r,login:u,logout:f},children:t})}function h(){let e=(0,a.useContext)(c);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},5695:(e,t,r)=>{"use strict";var s=r(8999);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"usePathname")&&r.d(t,{usePathname:function(){return s.usePathname}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}}),r.o(s,"useSearchParams")&&r.d(t,{useSearchParams:function(){return s.useSearchParams}})},8661:(e,t,r)=>{Promise.resolve().then(r.bind(r,1057))},9946:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(2115);let a=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>!!e&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var o={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let c=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:a=24,strokeWidth:c=2,absoluteStrokeWidth:i,className:h="",children:l,iconNode:u,...f}=e;return(0,s.createElement)("svg",{ref:t,...o,width:a,height:a,stroke:r,strokeWidth:i?24*Number(c)/Number(a):c,className:n("lucide",h),...f},[...u.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(l)?l:[l]])}),i=(e,t)=>{let r=(0,s.forwardRef)((r,o)=>{let{className:i,...h}=r;return(0,s.createElement)(c,{ref:o,iconNode:t,className:n("lucide-".concat(a(e)),i),...h})});return r.displayName="".concat(e),r}}},e=>{var t=t=>e(e.s=t);e.O(0,[8441,1684,7358],()=>t(8661)),_N_E=e.O()}]);