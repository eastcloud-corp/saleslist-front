(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6801],{88:(e,s,t)=>{"use strict";t.d(s,{d:()=>i});var a=t(5155);t(2115);var n=t(7161),r=t(3999);function i(e){let{className:s,...t}=e;return(0,a.jsx)(n.bL,{"data-slot":"switch",className:(0,r.cn)("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:(0,a.jsx)(n.zi,{"data-slot":"switch-thumb",className:(0,r.cn)("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}},4731:(e,s,t)=>{"use strict";t.d(s,{ProjectDetailClient:()=>D});var a=t(5155),n=t(2115),r=t(5695),i=t(6874),l=t.n(i),c=t(7814),d=t(7168),m=t(8145),o=t(88),x=t(8482),h=t(8524),u=t(5784),j=t(3227),p=t(4616),v=t(3786),f=t(9074),g=t(3580),N=t(4748);function b(e){let{companies:s,onUpdateStatus:t,onRemoveCompany:r,onToggleActive:i,onAddCompany:c,projectId:m,isLoading:b=!1}=e,{toast:y}=(0,g.dj)(),{statuses:w}=(0,N.o)(),[_,A]=(0,n.useState)(null),[k,C]=(0,n.useState)(""),[S,D]=(0,n.useState)("");w.length>0&&w.map(e=>({value:e.name,label:e.name,variant:"NG"===e.name?"destructive":"default"}));let P=async(e,s)=>{try{var t;await i((null===(t=e.company_id)||void 0===t?void 0:t.toString())||e.id.toString(),s),y({title:"成功",description:"企業を".concat(s?"有効化":"無効化","しました")})}catch(e){y({title:"エラー",description:"企業の".concat(s?"有効化":"無効化","に失敗しました"),variant:"destructive"})}},$=e=>e?new Date(e).toLocaleDateString("ja-JP"):"未設定";return(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)(x.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(j.A,{className:"h-5 w-5"}),"Project Companies (",s.length,")"]}),(0,a.jsxs)(d.$,{onClick:c,size:"sm",children:[(0,a.jsx)(p.A,{className:"h-4 w-4 mr-2"}),"企業を追加"]})]})}),(0,a.jsx)(x.Wu,{children:0===s.length?(0,a.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,a.jsx)(j.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,a.jsx)("p",{children:"この案件にはまだ企業が追加されていません"}),(0,a.jsx)("p",{className:"text-sm",children:"企業を追加して営業進捗の管理を開始してください"})]}):(0,a.jsx)("div",{className:"rounded-md border",children:(0,a.jsxs)(h.XI,{children:[(0,a.jsx)(h.A0,{children:(0,a.jsxs)(h.Hj,{children:[(0,a.jsx)(h.nd,{children:"企業名"}),(0,a.jsx)(h.nd,{children:"業界"}),(0,a.jsx)(h.nd,{children:"ステータス"}),(0,a.jsx)(h.nd,{children:"最終接触"}),(0,a.jsx)(h.nd,{children:"アクティブ"}),(0,a.jsx)(h.nd,{className:"w-[120px]",children:"操作"})]})}),(0,a.jsx)(h.BF,{children:s.map(e=>{var s,n,r,i,c,x;let j=!1!==e.is_active;return(0,a.jsxs)(h.Hj,{className:j?"":"opacity-60 bg-gray-50",children:[(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium",children:e.company_name||(null===(s=e.company)||void 0===s?void 0:s.name)||"企業名不明"}),(null===(n=e.company)||void 0===n?void 0:n.website)&&(0,a.jsxs)("a",{href:e.company.website,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-muted-foreground hover:text-primary flex items-center gap-1 mt-1",children:[(null===(i=e.company)||void 0===i?void 0:null===(r=i.website)||void 0===r?void 0:r.replace(/^https?:\/\//,""))||"",(0,a.jsx)(v.A,{className:"h-3 w-3"})]})]})}),(0,a.jsx)(h.nA,{children:e.company_industry||(null===(c=e.company)||void 0===c?void 0:c.industry)||"-"}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)(u.l6,{value:e.status,onValueChange:s=>{var a,n;return t((null===(n=e.company)||void 0===n?void 0:null===(a=n.id)||void 0===a?void 0:a.toString())||"",s)},children:[(0,a.jsx)(u.bq,{className:"w-40",children:(0,a.jsx)(u.yv,{})}),(0,a.jsx)(u.gC,{children:[{value:"未接触",label:"未接触"},{value:"DM送信予定",label:"DM送信予定"},{value:"DM送信済み",label:"DM送信済み"},{value:"返信あり",label:"返信あり"},{value:"アポ獲得",label:"アポ獲得"},{value:"成約",label:"成約"},{value:"NG",label:"NG"}].map(e=>(0,a.jsx)(u.eb,{value:e.value,children:e.label},e.value))})]})}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex items-center gap-1 text-sm",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),$(e.contact_date)]})}),(0,a.jsx)(h.nA,{children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(o.d,{checked:j,onCheckedChange:s=>P(e,s),disabled:b}),(0,a.jsx)("span",{className:"text-sm",children:j?"有効":"無効"})]})}),(0,a.jsx)(h.nA,{children:(0,a.jsx)(d.$,{asChild:!0,variant:"outline",size:"sm",children:(0,a.jsx)(l(),{href:"/projects/".concat(m,"/companies/").concat(e.company_id||(null===(x=e.company)||void 0===x?void 0:x.id)),children:"営業詳細"})})})]},e.id)})})]})})})]})}var y=t(767),w=t(9026),_=t(1154),A=t(7550),k=t(4395),C=t(3717),S=t(2525);function D(e){var s,t;let{projectId:i}=e,[o,h]=(0,n.useState)(!1),[u,j]=(0,n.useState)(!1),p=(0,r.useRouter)(),{project:v,isLoading:g,error:N,updateProject:D,updateCompanyStatus:P,removeCompany:$}=(0,y.B)(i),z=async e=>{try{await D(e),h(!1)}catch(e){}},E=async()=>{if(confirm("この案件を削除してもよろしいですか？（ステータスが'削除済み'に変更されます）")){j(!0);try{await D({status:"削除済み"}),p.push("/projects")}catch(e){j(!1)}}},F=async(e,s,t)=>{try{await P(Number(e),{status:s,notes:t})}catch(e){throw e}},B=async(e,s)=>{try{await P(Number(e),{is_active:s})}catch(e){throw e}},L=e=>e?new Date(e).toLocaleDateString("ja-JP"):"未設定";return g?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.A,{className:"h-6 w-6 animate-spin"}),(0,a.jsx)("span",{children:"案件情報を読み込み中..."})]})}):N||!v?(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center gap-4",children:(0,a.jsx)(d.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(l(),{href:"/projects",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"案件一覧に戻る"]})})}),(0,a.jsx)(w.Fc,{variant:"destructive",children:(0,a.jsx)(w.TN,{children:N||"案件が見つかりません"})})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(d.$,{variant:"outline",asChild:!0,children:(0,a.jsxs)(l(),{href:"/projects",children:[(0,a.jsx)(A.A,{className:"h-4 w-4 mr-2"}),"案件一覧に戻る"]})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[(0,a.jsx)(k.A,{className:"h-8 w-8"}),v.name]}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"案件の詳細情報と企業管理"})]})]}),(0,a.jsx)("div",{className:"flex items-center gap-2",children:!o&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(d.$,{variant:"outline",onClick:()=>h(!0),children:[(0,a.jsx)(C.A,{className:"h-4 w-4 mr-2"}),"編集"]}),(0,a.jsxs)(d.$,{variant:"destructive",onClick:E,disabled:u,children:[(0,a.jsx)(S.A,{className:"h-4 w-4 mr-2"}),u?"削除中...":"削除"]})]})})]}),o?(0,a.jsx)(c.o,{project:v,onSave:z,onCancel:()=>h(!1)}):(0,a.jsxs)(x.Zp,{children:[(0,a.jsx)(x.aR,{children:(0,a.jsx)(x.ZB,{children:"案件情報"})}),(0,a.jsxs)(x.Wu,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"ステータス"}),(t=v.status)?(0,a.jsx)(m.E,{variant:{active:"default",paused:"secondary",completed:"outline"}[t]||"outline",children:t.charAt(0).toUpperCase()+t.slice(1)}):(0,a.jsx)(m.E,{variant:"outline",children:"未設定"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"契約開始日"}),(0,a.jsxs)("p",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),L(v.start_date||"")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"契約終了日"}),(0,a.jsxs)("p",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),L(v.end_date||"")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"企業数"}),(0,a.jsxs)("p",{children:[v.company_count||(null===(s=v.companies)||void 0===s?void 0:s.length)||0," 社"]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"進行状況"}),(0,a.jsx)("p",{children:v.progress_status||"未設定"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"アポ数"}),(0,a.jsx)("p",{className:"font-medium text-blue-600",children:v.appointment_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"承認数"}),(0,a.jsx)("p",{className:"font-medium text-green-600",children:v.approval_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"返信数"}),(0,a.jsx)("p",{className:"font-medium text-orange-600",children:v.reply_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"友達数"}),(0,a.jsx)("p",{className:"font-medium text-purple-600",children:v.friends_count||0})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"ディレクター"}),(0,a.jsx)("p",{children:v.director||"未設定"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"運用者"}),(0,a.jsx)("p",{children:v.operator||"未設定"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"営業マン"}),(0,a.jsx)("p",{children:v.sales_person||"未設定"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"運用開始日"}),(0,a.jsxs)("p",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),L(v.operation_start_date||"")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"終了予定日"}),(0,a.jsxs)("p",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),L(v.expected_end_date||"")]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-1",children:"作成日"}),(0,a.jsxs)("p",{className:"flex items-center gap-1",children:[(0,a.jsx)(f.A,{className:"h-3 w-3"}),L(v.created_at)]})]})]}),v.description&&(0,a.jsxs)("div",{className:"mt-6 pt-6 border-t",children:[(0,a.jsx)("h4",{className:"font-medium text-sm text-muted-foreground mb-2",children:"説明"}),(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:v.description})]})]})]}),(0,a.jsx)(b,{companies:v.companies||[],onUpdateStatus:F,onRemoveCompany:async e=>{await $(Number(e))},onToggleActive:B,onAddCompany:()=>{p.push("/projects/".concat(i,"/add-companies"))},projectId:i})]})}},8419:(e,s,t)=>{Promise.resolve().then(t.bind(t,4731)),Promise.resolve().then(t.bind(t,5646))},9026:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>l,TN:()=>d,XL:()=>c});var a=t(5155);t(2115);var n=t(2085),r=t(3999);let i=(0,n.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function l(e){let{className:s,variant:t,...n}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,r.cn)(i({variant:t}),s),...n})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-title",className:(0,r.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",s),...t})}function d(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,r.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}}},e=>{var s=s=>e(e.s=s);e.O(0,[8823,7715,7501,2717,2286,4686,5646,7869,9050,7814,8441,1684,7358],()=>s(8419)),_N_E=e.O()}]);