(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[893],{2193:(e,t,s)=>{"use strict";s.d(t,{k:()=>n});var a=s(5155),l=s(1154),i=s(3999);function n(e){let{size:t="md",className:s,text:n}=e;return(0,a.jsxs)("div",{className:(0,i.cn)("flex flex-col items-center justify-center",s),children:[(0,a.jsx)(l.A,{className:(0,i.cn)("animate-spin",{sm:"h-4 w-4",md:"h-8 w-8",lg:"h-12 w-12"}[t])}),n&&(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:n})]})}},2797:(e,t,s)=>{"use strict";s.d(t,{b:()=>d});var a=s(2115);s(7650);var l=s(6634),i=s(5155),n=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,t)=>{let s=(0,l.TL)(`Primitive.${t}`),n=a.forwardRef((e,a)=>{let{asChild:l,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,i.jsx)(l?s:t,{...n,ref:a})});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{}),r=a.forwardRef((e,t)=>(0,i.jsx)(n.label,{...e,ref:t,onMouseDown:t=>{var s;t.target.closest("button, input, select, textarea")||(null===(s=e.onMouseDown)||void 0===s||s.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));r.displayName="Label";var d=r},4229:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]])},5139:(e,t,s)=>{"use strict";s.d(t,{S:()=>r});var a=s(5155);s(2115);var l=s(8030),i=s(5196),n=s(3999);function r(e){let{className:t,...s}=e;return(0,a.jsx)(l.bL,{"data-slot":"checkbox",className:(0,n.cn)("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:(0,a.jsx)(l.C1,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:(0,a.jsx)(i.A,{className:"size-3.5"})})})}},5443:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>R});var a=s(5155),l=s(2115),i=s(5646),n=s(7814),r=s(767),d=s(3983),c=s(7259),x=s(3398),o=s(7168),m=s(8482),u=s(8145),p=s(9840),h=s(9852),g=s(2714),j=s(5784);let v=(0,s(9946).A)("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);var f=s(4616),_=s(7924),N=s(4395),w=s(3580),y=s(6874),b=s.n(y),k=s(9474),C=s(5139),S=s(9676);let E="".concat(200,"px"),z=e=>e?new Date(e).toLocaleDateString("ja-JP"):"未設定",M=(0,l.memo)(e=>{var t,s,i,n,r,d,c,x,m,u,p,g,v,f,_,N;let{project:w,editMode:y,isPending:M,pendingChanges:A={},progressStatuses:O,serviceTypes:P,meetingStatuses:T,mediaTypes:D,listImportSources:L,listAvailabilities:q,onFieldChange:J,onOpenHistory:R}=e,V=Number(w.id),$=(e,t)=>{let s=A[e];return void 0!==s?s:t},I=(e,t)=>{if("debug"===t)return;let s=t?Number.parseInt(t,10):void 0,a=w[e];J(V,{[e]:void 0===s||s===a?void 0:s})},F=(e,t)=>{let s=Number.parseInt(t,10)||0,a=w[e];J(V,{[e]:s===a?void 0:s})},H=(e,t)=>{let s=!0===t,a=!!w[e];J(V,{[e]:s===a?void 0:s})},B=(e,t)=>{let s=w[e];J(V,{[e]:t===(null!=s?s:"")?void 0:t})},U=(0,l.useMemo)(()=>{let e=A.progress_status_id;return void 0!==e?null==e?"":String(e):null!=w.progress_status_id?String(w.progress_status_id):""},[A.progress_status_id,w.progress_status_id]),G=(0,l.useMemo)(()=>{let e=A.service_type_id;return void 0!==e?null==e?"":String(e):null!=w.service_type_id?String(w.service_type_id):""},[A.service_type_id,w.service_type_id]),W=(0,l.useMemo)(()=>{let e=A.media_type_id;return void 0!==e?null==e?"":String(e):null!=w.media_type_id?String(w.media_type_id):""},[A.media_type_id,w.media_type_id]),Z=(0,l.useMemo)(()=>{let e=A.regular_meeting_status_id;return void 0!==e?null==e?"":String(e):null!=w.regular_meeting_status_id?String(w.regular_meeting_status_id):""},[A.regular_meeting_status_id,w.regular_meeting_status_id]),Y=(0,l.useMemo)(()=>{let e=A.list_availability_id;return void 0!==e?null==e?"":String(e):null!=w.list_availability_id?String(w.list_availability_id):""},[A.list_availability_id,w.list_availability_id]),K=(0,l.useMemo)(()=>{let e=A.list_import_source_id;return void 0!==e?null==e?"":String(e):null!=w.list_import_source_id?String(w.list_import_source_id):""},[A.list_import_source_id,w.list_import_source_id]),X=(null===(t=w.name)||void 0===t?void 0:t.trim())||"案件 ".concat(w.id),Q=null===(s=w.client_company)||void 0===s?void 0:s.trim(),ee=null===(i=w.client_name)||void 0===i?void 0:i.trim(),et=!!(Q&&ee&&Q!==ee),es=(0,a.jsx)("td",{className:"sticky left-0 z-20 bg-background group-hover:bg-muted/60 px-3 py-2 align-top border-r border-border min-w-[200px]",children:(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)(b(),{href:"/projects/".concat(w.id),className:"text-xs font-medium text-primary hover:underline leading-tight",children:X}),(0,a.jsxs)("span",{className:"text-[11px] text-muted-foreground",children:["案件ID: ",w.id]}),y?(0,a.jsx)("span",{className:"text-[10px] font-medium text-red-500",children:"編集中"}):null]})},"project"),ea=(0,a.jsxs)("td",{className:"sticky z-10 bg-background group-hover:bg-muted/60 px-3 py-2 align-top border-r border-border min-w-[200px]",style:{left:E},children:[(0,a.jsx)("div",{className:"text-xs font-medium text-foreground leading-tight",children:Q||ee||"クライアント未設定"}),et?(0,a.jsxs)("span",{className:"text-[11px] text-muted-foreground",children:["担当: ",ee]}):null]},"client"),el=[(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[180px]",children:w.progress_status||"-"},"progress"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:w.appointment_count||0},"appointment"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:w.approval_count||0},"approval"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:w.reply_count||0},"reply"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:w.friends_count||0},"friends"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:w.director_login_available?"✓":""},"director-login"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:w.operator_group_invited?"✓":""},"operator-invite"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.situation||"-"},"situation"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:z(w.regular_meeting_date)},"regular-meeting"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[100px]",children:w.list_import_source||"-"},"list-source"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:z(w.entry_date_sales)},"entry-date"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.progress_tasks||"-"},"progress-tasks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.daily_tasks||"-"},"daily-tasks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.reply_check_notes||"-"},"reply-notes"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.remarks||"-"},"remarks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:w.complaints_requests||"-"},"complaints"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:w.director||"-"},"director"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:w.operator||"-"},"operator"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:w.sales_person||"-"},"sales"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:z(w.operation_start_date)},"operation-start"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:z(w.expected_end_date)},"expected-end"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[100px]",children:w.service_type||"-"},"service"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[80px]",children:w.media_type||"-"},"media"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[100px]",children:w.regular_meeting_status||"-"},"meeting-status"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[80px]",children:w.list_availability||"-"},"list-availability"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[60px]",children:(0,a.jsx)("div",{className:"font-medium text-blue-600",children:w.company_count||0})},"company-count"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[120px]",children:(0,a.jsx)("div",{className:"flex items-center justify-center gap-2",children:(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>R(w),children:[(0,a.jsx)(S.A,{className:"h-3 w-3 mr-1"}),"履歴"]})})},"history")],ei=[(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[180px]",children:(0,a.jsxs)(j.l6,{value:U,onValueChange:e=>I("progress_status_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:w.progress_status||"進行状況を選択"})}),(0,a.jsxs)(j.gC,{children:[(0,a.jsxs)(j.eb,{value:"debug",className:"text-red-500 text-xs",children:["DEBUG: ",O.length,"件"]}),O.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))]})]})},"progress"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:(0,a.jsx)(h.p,{type:"number",value:$("appointment_count",w.appointment_count||0),onChange:e=>F("appointment_count",e.target.value),className:"w-12 h-8 text-xs text-center p-1"})},"appointment"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:(0,a.jsx)(h.p,{type:"number",value:$("approval_count",w.approval_count||0),onChange:e=>F("approval_count",e.target.value),className:"w-12 h-8 text-xs text-center p-1"})},"approval"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:(0,a.jsx)(h.p,{type:"number",value:$("reply_count",w.reply_count||0),onChange:e=>F("reply_count",e.target.value),className:"w-12 h-8 text-xs text-center p-1"})},"reply"),(0,a.jsx)("td",{className:"p-1 align-middle text-center text-xs min-w-[50px] w-[50px]",children:(0,a.jsx)(h.p,{type:"number",value:$("friends_count",w.friends_count||0),onChange:e=>F("friends_count",e.target.value),className:"w-12 h-8 text-xs text-center p-1"})},"friends"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(C.S,{checked:$("director_login_available",w.director_login_available||!1),onCheckedChange:e=>H("director_login_available",e)})},"director-login"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(C.S,{checked:$("operator_group_invited",w.operator_group_invited||!1),onCheckedChange:e=>H("operator_group_invited",e)})},"operator-invite"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(n=$("situation",w.situation||""))&&void 0!==n?n:"",onChange:e=>B("situation",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"situation"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{type:"date",value:null!==(r=$("regular_meeting_date",w.regular_meeting_date||""))&&void 0!==r?r:"",onChange:e=>B("regular_meeting_date",e.target.value),className:"h-8 text-xs"})},"regular-meeting"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[100px]",children:(0,a.jsxs)(j.l6,{value:K,onValueChange:e=>I("list_import_source_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:"リスト輸入先を選択"})}),(0,a.jsx)(j.gC,{children:L.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))})]})},"list-source"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{type:"date",value:null!==(d=$("entry_date_sales",w.entry_date_sales||""))&&void 0!==d?d:"",onChange:e=>B("entry_date_sales",e.target.value),className:"h-8 text-xs"})},"entry-date"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(c=$("progress_tasks",w.progress_tasks||""))&&void 0!==c?c:"",onChange:e=>B("progress_tasks",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"progress-tasks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(x=$("daily_tasks",w.daily_tasks||""))&&void 0!==x?x:"",onChange:e=>B("daily_tasks",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"daily-tasks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(m=$("reply_check_notes",w.reply_check_notes||""))&&void 0!==m?m:"",onChange:e=>B("reply_check_notes",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"reply-notes"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(u=$("remarks",w.remarks||""))&&void 0!==u?u:"",onChange:e=>B("remarks",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"remarks"),(0,a.jsx)("td",{className:"p-2 align-top text-xs min-w-[150px]",children:(0,a.jsx)(k.T,{value:null!==(p=$("complaints_requests",w.complaints_requests||""))&&void 0!==p?p:"",onChange:e=>B("complaints_requests",e.target.value),className:"w-full h-12 text-xs p-1 resize-none",rows:2})},"complaints"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{value:null!==(g=$("director",w.director||""))&&void 0!==g?g:"",onChange:e=>B("director",e.target.value),className:"h-8 text-xs"})},"director"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{value:null!==(v=$("operator",w.operator||""))&&void 0!==v?v:"",onChange:e=>B("operator",e.target.value),className:"h-8 text-xs"})},"operator"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{value:null!==(f=$("sales_person",w.sales_person||""))&&void 0!==f?f:"",onChange:e=>B("sales_person",e.target.value),className:"h-8 text-xs"})},"sales"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{type:"date",value:null!==(_=$("operation_start_date",w.operation_start_date||""))&&void 0!==_?_:"",onChange:e=>B("operation_start_date",e.target.value),className:"h-8 text-xs"})},"operation-start"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[80px]",children:(0,a.jsx)(h.p,{type:"date",value:null!==(N=$("expected_end_date",w.expected_end_date||""))&&void 0!==N?N:"",onChange:e=>B("expected_end_date",e.target.value),className:"h-8 text-xs"})},"expected-end"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[100px]",children:(0,a.jsxs)(j.l6,{value:G,onValueChange:e=>I("service_type_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:"サービスを選択"})}),(0,a.jsx)(j.gC,{children:P.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))})]})},"service"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:(0,a.jsxs)(j.l6,{value:W,onValueChange:e=>I("media_type_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:"媒体を選択"})}),(0,a.jsx)(j.gC,{children:D.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))})]})},"media"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[100px]",children:(0,a.jsxs)(j.l6,{value:Z,onValueChange:e=>I("regular_meeting_status_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:"定例会ステータスを選択"})}),(0,a.jsx)(j.gC,{children:T.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))})]})},"meeting-status"),(0,a.jsx)("td",{className:"p-2 align-middle text-xs min-w-[80px]",children:(0,a.jsxs)(j.l6,{value:Y,onValueChange:e=>I("list_availability_id",e),children:[(0,a.jsx)(j.bq,{className:"h-8 text-xs",children:(0,a.jsx)(j.yv,{placeholder:"リスト有無を選択"})}),(0,a.jsx)(j.gC,{children:q.map(e=>(0,a.jsx)(j.eb,{value:e.id.toString(),className:"text-xs",children:e.name},e.id))})]})},"list-availability"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[60px]",children:(0,a.jsx)("div",{className:"font-medium text-blue-600",children:w.company_count||0})},"company-count"),(0,a.jsx)("td",{className:"p-2 align-middle text-center text-xs min-w-[120px]",children:(0,a.jsx)("div",{className:"flex items-center justify-center gap-2",children:(0,a.jsxs)(o.$,{variant:"outline",size:"sm",onClick:()=>R(w),disabled:M,children:[(0,a.jsx)(S.A,{className:"h-3 w-3 mr-1"}),"履歴"]})})},"history")];return(0,a.jsxs)("tr",{"data-project-id":w.id,className:"group border-b hover:bg-muted/40","aria-busy":M,children:[es,ea,y?ei:el]})});M.displayName="ProjectTableRow";var A=s(8524),O=s(2193),P=s(3999);let T={name:"案件名",client_name:"クライアント",progress_status:"進行状況",service_type:"サービス",media_type:"媒体",director:"ディレクター",operator:"運用者",sales_person:"営業",appointment_count:"アポ数",approval_count:"承認数",reply_count:"返信数",friends_count:"友達数",expected_end_date:"終了予定日",operation_start_date:"運用開始日",situation:"状況"};function D(e){try{let t=new Date(e);if(Number.isNaN(t.getTime()))return e;return t.toLocaleString("ja-JP",{hour12:!1,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch(t){return e}}function L(e){var t;let{project:s,open:i,onOpenChange:n,onRestored:r}=e,[d,x]=(0,l.useState)([]),[m,h]=(0,l.useState)(!1),[g,j]=(0,l.useState)(null),[v,f]=(0,l.useState)(null),[_,N]=(0,l.useState)(null),{toast:y}=(0,w.dj)(),b=s?String(s.id):null,k=(0,l.useCallback)(async()=>{if(b){h(!0),j(null);try{var e;let t=await c.uE.get("".concat(c.i3.ENDPOINTS.PROJECT_SNAPSHOTS(b),"?page_size=").concat(25));if(!t.ok){let e=await t.text();throw Error("履歴の取得に失敗しました (".concat(t.status,") ").concat(e))}let s=await t.json(),a=Array.isArray(s)?s:null!==(e=s.results)&&void 0!==e?e:[];x(a)}catch(e){j(e instanceof Error?e.message:"履歴の取得でエラーが発生しました")}finally{h(!1)}}},[b]);(0,l.useEffect)(()=>{i&&b&&k(),i||(x([]),j(null),f(null),N(null))},[i,b,k]);let C=(0,l.useMemo)(()=>{if(!d.length)return[];let e=new Date;return e.setDate(e.getDate()-7),d.filter(t=>{if(!t.created_at)return!1;let s=new Date(t.created_at);return!Number.isNaN(s.getTime())&&s>=e})},[d]),S=C.length>0?C:d,E=0===C.length&&d.length>0,z=(0,l.useCallback)(async e=>{if(b){f(e);try{let t=await c.uE.post(c.i3.ENDPOINTS.PROJECT_SNAPSHOT_RESTORE(b,String(e)),{});if(!t.ok){let e=await t.text();throw Error("復元に失敗しました (".concat(t.status,") ").concat(e))}y({title:"スナップショットを復元しました",description:"案件の内容を更新しました。"}),await Promise.all([k(),r?Promise.resolve(r()):Promise.resolve()])}catch(e){y({title:"復元に失敗しました",description:e instanceof Error?e.message:"復元処理でエラーが発生しました。",variant:"destructive"})}finally{f(null)}}},[b,k,r,y]),M=(null==s?void 0:null===(t=s.name)||void 0===t?void 0:t.trim())||(s?"案件 ".concat(s.id):"案件");return(0,a.jsx)(p.lG,{open:i,onOpenChange:n,children:(0,a.jsxs)(p.Cf,{className:"w-[min(95vw,1200px)] max-w-5xl",children:[(0,a.jsxs)(p.c7,{children:[(0,a.jsxs)(p.L3,{children:[M," の履歴"]}),(0,a.jsxs)(p.rr,{children:["過去",7,"日以内に保存されたスナップショットを表示します。必要に応じて復元操作を行うことができます。"]})]}),m?(0,a.jsx)("div",{className:"py-12",children:(0,a.jsx)(O.k,{size:"md",text:"履歴を読み込み中です"})}):g?(0,a.jsx)("div",{className:"rounded-md border border-destructive/50 bg-destructive/10 px-4 py-3 text-sm text-destructive",children:g}):0===S.length?(0,a.jsxs)("p",{className:"py-8 text-center text-sm text-muted-foreground",children:["過去",7,"日以内の履歴は見つかりませんでした。"]}):(0,a.jsxs)("div",{className:"max-h-[480px] overflow-y-auto overflow-x-auto pr-2",children:[E&&(0,a.jsxs)("p",{className:"mb-3 text-xs text-muted-foreground",children:["過去",7,"日以内の履歴が無かったため、取得できる最新の履歴を表示しています。"]}),(0,a.jsxs)(A.XI,{children:[(0,a.jsx)(A.A0,{children:(0,a.jsxs)(A.Hj,{children:[(0,a.jsx)(A.nd,{className:"min-w-[160px]",children:"保存日時"}),(0,a.jsx)(A.nd,{className:"min-w-[120px]",children:"操作種別"}),(0,a.jsx)(A.nd,{className:"min-w-[140px]",children:"担当者"}),(0,a.jsx)(A.nd,{className:"min-w-[200px]",children:"変更項目"}),(0,a.jsx)(A.nd,{className:"min-w-[240px]",children:"概要"}),(0,a.jsx)(A.nd,{className:"min-w-[160px] text-right",children:"アクション"})]})}),(0,a.jsx)(A.BF,{children:S.map(e=>{var t;let s=function(e){if(e.changed_fields&&e.changed_fields.length>0)return e.changed_fields;if(!e.reason)return[];let t=e.reason.split(":",2);return t.length<2?[]:t[1].split(",").map(e=>e.trim()).filter(Boolean)}(e),i=(t=e.project_overview)?Object.entries(t).map(e=>{var t;let s,[a,l]=e,i=null!==(t=T[a])&&void 0!==t?t:a;return s=null==l||""===l?"-":"number"==typeof l?l.toString():"string"==typeof l&&(a.endsWith("_date")||a.endsWith("_at")||/date/i.test(a))?D(l):String(l),{key:a,label:i,value:s}}):[],n=i.slice(0,6),r=_===e.id,d=s.filter(e=>!i.some(t=>t.key===e));return(0,a.jsxs)(l.Fragment,{children:[(0,a.jsxs)(A.Hj,{children:[(0,a.jsx)(A.nA,{children:D(e.created_at)}),(0,a.jsx)(A.nA,{children:(0,a.jsx)(u.E,{variant:"secondary",className:"text-[10px]",children:e.source_label||e.source||"操作"})}),(0,a.jsx)(A.nA,{children:e.created_by_name||(e.created_by?"ユーザー#".concat(e.created_by):"-")}),(0,a.jsx)(A.nA,{children:s.length?(0,a.jsx)("div",{className:"flex flex-wrap gap-1",children:s.map(e=>(0,a.jsx)(u.E,{variant:"outline",className:"text-[10px]",children:e},e))}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"記録なし"})}),(0,a.jsx)(A.nA,{children:n.length?(0,a.jsxs)("div",{className:"space-y-1 text-[11px] leading-tight",children:[n.map(e=>(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"text-muted-foreground",children:[e.label,":"]})," ",e.value]},e.key)),i.length>n.length&&(0,a.jsxs)("span",{className:"text-[10px] text-muted-foreground",children:["ほか ",i.length-n.length," 件"]})]}):(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"概要情報はありません"})}),(0,a.jsx)(A.nA,{className:"text-right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)(o.$,{size:"sm",variant:"ghost",onClick:()=>{N(t=>t===e.id?null:e.id)},children:r?"詳細を閉じる":"詳細を見る"}),(0,a.jsx)(o.$,{size:"sm",variant:"outline",disabled:v===e.id,onClick:()=>z(e.id),children:v===e.id?"復元中...":"この状態に戻す"})]})})]}),r?(0,a.jsx)(A.Hj,{children:(0,a.jsx)(A.nA,{colSpan:6,children:(0,a.jsxs)("div",{className:"rounded-md border border-border bg-muted/30 p-4",children:[(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[(0,a.jsxs)("span",{children:["スナップショットID: ",e.id]}),e.reason&&(0,a.jsxs)("span",{children:["理由: ",e.reason]})]}),(0,a.jsx)("div",{className:"mt-4 grid gap-3 sm:grid-cols-2",children:i.length?i.map(e=>{let t=s.includes(e.key);return(0,a.jsxs)("div",{className:(0,P.cn)("rounded border border-border/60 bg-background p-3 text-sm",t&&"border-primary/60 bg-primary/5"),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-2 text-xs font-medium text-muted-foreground",children:[(0,a.jsx)("span",{children:e.label}),t&&(0,a.jsx)(u.E,{variant:"default",className:"text-[10px]",children:"更新"})]}),(0,a.jsx)("div",{className:"mt-1 break-words text-sm text-foreground",children:e.value})]},e.key)}):(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"このスナップショットには概要情報がありません。"})}),d.length>0&&(0,a.jsxs)("p",{className:"mt-3 text-xs text-muted-foreground",children:["表示対象外の項目が更新されています: ",d.join(", ")]})]})})}):null]},e.id)})})]})]})]})})}let q=(0,x.h)("projects:page"),J={search:"",client:"all",progress_status:"all",service_type:"all"};function R(){var e;let[t,s]=(0,l.useState)(!1),[x,u]=(0,l.useState)(!1),[y,b]=(0,l.useState)({}),[k,C]=(0,l.useState)(1/0),[S,E]=(0,l.useState)([]),[z,A]=(0,l.useState)([]),[O,P]=(0,l.useState)([]),[T,D]=(0,l.useState)([]),[R,V]=(0,l.useState)([]),[$,I]=(0,l.useState)([]),[F,H]=(0,l.useState)(J),[B,U]=(0,l.useState)(J),[G,W]=(0,l.useState)(null),[Z,Y]=(0,l.useState)(!1),K=(0,l.useMemo)(()=>{let e={};return B.search.trim()&&(e.search=B.search.trim()),"all"!==B.client&&(e.client=B.client),"all"!==B.progress_status&&(e.progress_status=B.progress_status),"all"!==B.service_type&&(e.service_type=B.service_type),e},[B]),X=(0,l.useMemo)(()=>{let e=Object.entries(K);return e.length?e.sort((e,t)=>{let[s]=e,[a]=t;return s.localeCompare(a)}).map(e=>{let[t,s]=e;return"".concat(t,":").concat(s)}).join("|"):"default"},[K]),Q=(0,l.useMemo)(()=>Object.keys(K).length>0,[K]),ee=(0,l.useMemo)(()=>JSON.stringify(F)!==JSON.stringify(B),[F,B]),{projects:et,isLoading:es,error:ea,createProject:el,refetch:ei,pagination:en}=(0,r.Y)({filters:K}),{clients:er,loading:ed}=(0,d.aq)({limit:200,filters:{is_active:!0}}),{toast:ec}=(0,w.dj)(),[ex,eo]=(0,l.useState)(!1),[em,eu]=(0,l.useState)(null),[ep,eh]=(0,l.useState)(!1),eg=(0,l.useRef)({page:1,page_size:20,filter_hash:"default"}),ej=null!==(e=null==en?void 0:en.total)&&void 0!==e?e:et.length,ev=x?et.slice(0,k):et,[ef,e_]=(0,l.useTransition)();(0,l.useEffect)(()=>{(async()=>{try{let[e,t,s,a,l,i]=await Promise.all([c.uE.get("/master/progress-statuses/"),c.uE.get("/master/service-types/"),c.uE.get("/master/meeting-statuses/"),c.uE.get("/master/media-types/"),c.uE.get("/master/list-import-sources/"),c.uE.get("/master/list-availabilities/")]),n=await e.json(),r=await t.json(),d=await s.json(),x=await a.json(),o=await l.json(),m=await i.json();E(n.results||[]),A(r.results||[]),P(d.results||[]),D(x.results||[]),V(o.results||[]),I(m.results||[])}catch(e){}})()},[]),(0,l.useEffect)(()=>{x?C(Math.min(12,et.length||0)||et.length):C(et.length)},[x,et.length]);let eN=(0,l.useCallback)(e=>{W(e),Y(!0)},[]),ew=(0,l.useCallback)((e,t)=>{b(s=>{var a;let l=Object.entries({...null!==(a=s[e])&&void 0!==a?a:{},...t}).filter(e=>{let[,t]=e;return void 0!==t});if(0===l.length){let{[e]:t,...a}=s;return a}return{...s,[e]:Object.fromEntries(l)}})},[]),ey=async()=>{let e=Object.keys(y).filter(e=>{let t=y[Number(e)];return t&&Object.keys(t).length>0}).map(e=>Number(e));if(0===e.length)return ec({title:"変更はありません",description:"更新対象の入力はありませんでした。"}),!0;try{var t;let s=e.map(e=>{let t=y[e];if(!t)return null;let s=Object.fromEntries(Object.entries(t).filter(e=>{let[,t]=e;return void 0!==t}));return 0===Object.keys(s).length?null:{project_id:e,data:s,reason:"Bulk partial update via UI"}}).filter(Boolean);if(0===s.length)return ec({title:"変更はありません",description:"更新対象の入力はありませんでした。"}),!0;let a=await c.uE.post(c.i3.ENDPOINTS.PROJECT_BULK_PARTIAL_UPDATE,{items:s});if(!a.ok){let e=await a.text();throw Error("案件の一括更新に失敗しました (".concat(a.status,") ").concat(e))}let l=await a.json();if(!(null==l?void 0:l.success)){let e=(null==l?void 0:l.error)||"案件の一括更新に失敗しました";throw Error(e)}return b({}),await ei(),ec({title:"保存しました",description:"".concat(null!==(t=l.updated_count)&&void 0!==t?t:e.length,"件の案件を更新しました。")}),!0}catch(e){return ec({title:"保存に失敗しました",description:e instanceof Error?e.message:"保存処理でエラーが発生しました。再度お試しください。",variant:"destructive"}),!1}},eb=(0,l.useCallback)(async()=>{if(!ep)return;let e=eg.current,t=new URLSearchParams({page:String(e.page),page_size:String(e.page_size),filter_hash:e.filter_hash});try{let e=await c.uE.delete("/projects/page-unlock/?".concat(t.toString()));e.ok||await e.text()}catch(e){}finally{eh(!1)}},[ep]);(0,l.useEffect)(()=>()=>{},[ep,eb]);let ek=()=>"undefined"!=typeof performance?performance.now():Date.now(),eC=async()=>{if(x)await ey()&&(await eb(),u(!1),C(et.length),ec({title:"編集モードを終了しました",description:"最新のデータに更新しました。"}));else{let e,t;eo(!0);let s={page:(null==en?void 0:en.page)||1,page_size:(null==en?void 0:en.limit)||Math.max(et.length,20),filter_hash:X},a=ek(),l=!1;try{let a=await c.uE.post("/projects/page-lock/",s);if(e=a.status,!a.ok){let e="";try{let t=await a.json();e=(null==t?void 0:t.error)||(null==t?void 0:t.message)||""}catch(t){e=await a.text()}ec({title:"編集モードを開始できません",description:e||"他のユーザーが編集中の可能性があります。",variant:"destructive"}),t=e;return}eg.current=s,e_(()=>{eh(!0),u(!0)}),l=!0,ec({title:"編集モードを開始しました",description:"入力後に「編集終了」で保存してください。"})}catch(e){t=e instanceof Error?e.message:String(e),ec({title:"編集モードを開始できません",description:e instanceof Error?e.message:"ロック取得中にエラーが発生しました。",variant:"destructive"})}finally{let i=Math.max(0,ek()-a);eu(i),q.info("page-lock attempt finished",{duration_ms:Math.round(i),success:l,status_code:e,page:s.page,page_size:s.page_size,filter_hash:s.filter_hash,error:t}),eo(!1)}}},eS=async e=>{try{await el({...e,created_by:"current-user"}),s(!1)}catch(e){}};return es?(0,a.jsx)(i.MainLayout,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"案件管理"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"営業キャンペーンを管理し、進捗を追跡"})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[...Array(6)].map((e,t)=>(0,a.jsx)("div",{className:"h-48 bg-muted animate-pulse rounded-lg"},t))})]})}):(0,a.jsxs)(i.MainLayout,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"案件管理"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"営業キャンペーンを管理し、進捗を追跡"})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsxs)(o.$,{variant:x?"default":"outline",onClick:eC,disabled:ex||ef,children:[(0,a.jsx)(v,{className:"h-4 w-4 mr-2"}),ex?"ロック取得中...":x?"編集完了":"編集モード",!ex&&(0,a.jsxs)("span",{className:"ml-1 text-xs",children:["(",x?"OFF":"ON",")"]})]}),!ex&&null!==em&&(0,a.jsxs)("span",{className:"self-center text-xs text-muted-foreground",children:["直近ロック: ",Math.round(em),"ms"]}),(0,a.jsxs)(p.lG,{open:t,onOpenChange:s,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsxs)(o.$,{children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"新規案件"]})}),(0,a.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:"新規案件作成"})}),(0,a.jsx)(n.o,{onSave:eS,onCancel:()=>s(!1)})]})]})]})]}),ea&&(0,a.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 text-destructive px-4 py-3 rounded-md",children:ea}),(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"pt-6",children:[(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.J,{htmlFor:"project-search",children:"キーワード"}),(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h.p,{id:"project-search",placeholder:"案件名・クライアント名で検索",value:F.search,onChange:e=>H(t=>({...t,search:e.target.value})),disabled:x,className:"pl-8",autoComplete:"off"}),(0,a.jsx)(_.A,{className:"absolute left-2 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.J,{htmlFor:"project-client-filter",children:"クライアント"}),(0,a.jsxs)(j.l6,{value:F.client,onValueChange:e=>H(t=>({...t,client:e})),disabled:x||ed,children:[(0,a.jsx)(j.bq,{id:"project-client-filter",children:(0,a.jsx)(j.yv,{placeholder:ed?"読み込み中...":"すべて"})}),(0,a.jsxs)(j.gC,{children:[(0,a.jsx)(j.eb,{value:"all",children:"すべて"}),ed?(0,a.jsx)(j.eb,{value:"loading",disabled:!0,children:"読み込み中..."}):er.map(e=>(0,a.jsx)(j.eb,{value:String(e.id),children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.J,{htmlFor:"project-progress-filter",children:"進行状況"}),(0,a.jsxs)(j.l6,{value:F.progress_status,onValueChange:e=>H(t=>({...t,progress_status:e})),disabled:x,children:[(0,a.jsx)(j.bq,{id:"project-progress-filter",children:(0,a.jsx)(j.yv,{placeholder:"すべて"})}),(0,a.jsxs)(j.gC,{children:[(0,a.jsx)(j.eb,{value:"all",children:"すべて"}),0===S.length?(0,a.jsx)(j.eb,{value:"no-data",disabled:!0,children:"選択肢を取得できませんでした"}):S.map(e=>(0,a.jsx)(j.eb,{value:String(e.id),children:e.name},e.id))]})]})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)(g.J,{htmlFor:"project-service-filter",children:"サービス種別"}),(0,a.jsxs)(j.l6,{value:F.service_type,onValueChange:e=>H(t=>({...t,service_type:e})),disabled:x,children:[(0,a.jsx)(j.bq,{id:"project-service-filter",children:(0,a.jsx)(j.yv,{placeholder:"すべて"})}),(0,a.jsxs)(j.gC,{children:[(0,a.jsx)(j.eb,{value:"all",children:"すべて"}),0===z.length?(0,a.jsx)(j.eb,{value:"no-service",disabled:!0,children:"選択肢を取得できませんでした"}):z.map(e=>(0,a.jsx)(j.eb,{value:String(e.id),children:e.name},e.id))]})]})]})]}),(0,a.jsxs)("div",{className:"mt-4 flex flex-wrap items-center justify-between gap-3",children:[(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:es?"案件を読み込み中...":"表示件数: ".concat(et.length,"件 / 総件数: ").concat(ej,"件")}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[x&&(0,a.jsx)("span",{className:"text-xs text-muted-foreground",children:"編集モード中はフィルターを変更できません"}),(0,a.jsx)(o.$,{type:"button",variant:"outline",onClick:()=>{H({...J}),U({...J})},disabled:!Q&&!ee||x,children:"フィルターをクリア"}),(0,a.jsxs)(o.$,{type:"button",onClick:()=>U({...F}),disabled:!ee||x,children:[(0,a.jsx)(_.A,{className:"mr-2 h-4 w-4"}),"検索"]})]})]})]})}),et&&0!==et.length?(0,a.jsxs)("div",{className:"border rounded-md overflow-x-auto",children:[(0,a.jsxs)("table",{className:"w-full border-separate",style:{borderSpacing:0},children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b",children:[(0,a.jsx)("th",{className:"sticky left-0 z-20 h-10 px-3 text-left align-middle text-xs font-medium text-muted-foreground bg-background min-w-[200px]",children:"案件名"}),(0,a.jsx)("th",{className:"sticky z-20 h-10 px-3 text-left align-middle text-xs font-medium text-muted-foreground bg-background min-w-[200px]",style:{left:"".concat(200,"px")},children:"クライアント"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[180px]",children:"進行状況"}),(0,a.jsx)("th",{className:"h-10 px-1 text-center align-middle text-xs font-medium text-muted-foreground min-w-[50px] w-[50px]",children:"アポ数"}),(0,a.jsx)("th",{className:"h-10 px-1 text-center align-middle text-xs font-medium text-muted-foreground min-w-[50px] w-[50px]",children:"承認数"}),(0,a.jsx)("th",{className:"h-10 px-1 text-center align-middle text-xs font-medium text-muted-foreground min-w-[50px] w-[50px]",children:"返信数"}),(0,a.jsx)("th",{className:"h-10 px-1 text-center align-middle text-xs font-medium text-muted-foreground min-w-[50px] w-[50px]",children:"友達数"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"Dログイン可"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"運用者招待"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"状況"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"定例会実施日"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[100px]",children:"リスト輸入先"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"記載日"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"進行タスク"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"デイリータスク"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"返信チェック"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"備考"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[150px]",children:"クレームor要望"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"ディレクター"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"運用者"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"営業マン"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"運用開始日"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"終了予定日"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[100px]",children:"サービス"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"媒体"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[100px]",children:"定例会ステータス"}),(0,a.jsx)("th",{className:"h-10 px-2 text-left align-middle text-xs font-medium text-muted-foreground min-w-[80px]",children:"リスト有無"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[60px]",children:"リスト数"}),(0,a.jsx)("th",{className:"h-10 px-2 text-center align-middle text-xs font-medium text-muted-foreground min-w-[120px]",children:"履歴"})]})}),(0,a.jsx)("tbody",{children:ev.map(e=>(0,a.jsx)(M,{project:e,editMode:x,isPending:!1,pendingChanges:y[Number(e.id)],progressStatuses:S,serviceTypes:z,meetingStatuses:O,mediaTypes:T,listImportSources:R,listAvailabilities:$,onFieldChange:ew,onOpenHistory:eN},e.id))})]}),x&&ev.length<et.length&&(0,a.jsx)("div",{className:"flex justify-center border-t bg-muted/30 py-3",children:(0,a.jsxs)(o.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{C(e=>Math.min(e+10,et.length))},children:["さらに",Math.min(et.length-ev.length,10),"件を表示"]})})]}):(0,a.jsx)(m.Zp,{children:(0,a.jsxs)(m.Wu,{className:"text-center py-12",children:[(0,a.jsx)(N.A,{className:"h-16 w-16 mx-auto mb-4 opacity-50"}),(0,a.jsx)("h3",{className:"text-lg font-medium mb-2",children:"案件がありません"}),(0,a.jsx)("p",{className:"text-muted-foreground mb-4",children:"最初の案件を作成して営業キャンペーンの管理を始めましょう。"}),(0,a.jsxs)(p.lG,{open:t,onOpenChange:s,children:[(0,a.jsx)(p.zM,{asChild:!0,children:(0,a.jsxs)(o.$,{children:[(0,a.jsx)(f.A,{className:"h-4 w-4 mr-2"}),"案件作成"]})}),(0,a.jsxs)(p.Cf,{className:"max-w-2xl",children:[(0,a.jsx)(p.c7,{children:(0,a.jsx)(p.L3,{children:"新規案件作成"})}),(0,a.jsx)(n.o,{onSave:eS,onCancel:()=>s(!1)})]})]})]})})]}),(0,a.jsx)(L,{project:G,open:Z,onOpenChange:e=>{Y(e),e||W(null)},onRestored:async()=>{await ei()}})]})}},9144:(e,t,s)=>{Promise.resolve().then(s.bind(s,5443))},9676:(e,t,s)=>{"use strict";s.d(t,{A:()=>a});let a=(0,s(9946).A)("History",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M12 7v5l4 2",key:"1fdv2h"}]])},9840:(e,t,s)=>{"use strict";s.d(t,{Cf:()=>o,Es:()=>u,L3:()=>p,c7:()=>m,lG:()=>r,rr:()=>h,zM:()=>d});var a=s(5155);s(2115);var l=s(85),i=s(4416),n=s(3999);function r(e){let{...t}=e;return(0,a.jsx)(l.bL,{"data-slot":"dialog",...t})}function d(e){let{...t}=e;return(0,a.jsx)(l.l9,{"data-slot":"dialog-trigger",...t})}function c(e){let{...t}=e;return(0,a.jsx)(l.ZL,{"data-slot":"dialog-portal",...t})}function x(e){let{className:t,...s}=e;return(0,a.jsx)(l.hJ,{"data-slot":"dialog-overlay",className:(0,n.cn)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function o(e){let{className:t,children:s,showCloseButton:r=!0,...d}=e;return(0,a.jsxs)(c,{"data-slot":"dialog-portal",children:[(0,a.jsx)(x,{}),(0,a.jsxs)(l.UC,{"data-slot":"dialog-content",className:(0,n.cn)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...d,children:[s,r&&(0,a.jsxs)(l.bm,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[(0,a.jsx)(i.A,{}),(0,a.jsx)("span",{className:"sr-only",children:"Close"})]})]})]})}function m(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-header",className:(0,n.cn)("flex flex-col gap-2 text-center sm:text-left",t),...s})}function u(e){let{className:t,...s}=e;return(0,a.jsx)("div",{"data-slot":"dialog-footer",className:(0,n.cn)("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function p(e){let{className:t,...s}=e;return(0,a.jsx)(l.hE,{"data-slot":"dialog-title",className:(0,n.cn)("text-lg leading-none font-semibold",t),...s})}function h(e){let{className:t,...s}=e;return(0,a.jsx)(l.VY,{"data-slot":"dialog-description",className:(0,n.cn)("text-muted-foreground text-sm",t),...s})}}},e=>{var t=t=>e(e.s=t);e.O(0,[8823,7715,7501,2717,2286,85,6358,5646,7869,9050,7814,8441,1684,7358],()=>t(9144)),_N_E=e.O()}]);